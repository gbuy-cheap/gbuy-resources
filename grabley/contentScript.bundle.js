(()=>{"use strict";const e=e=>e.indexOf("C $")>=0?"C $":e.indexOf("CDN$")>=0?"CDN$":e.indexOf("€")>=0?"€":e.indexOf("£")>=0?"£":e.indexOf("zł")>=0?"zł":e.indexOf("AU $")>=0?"AU $":e.indexOf("US $")>=0?"US $":e.indexOf("CHF")>=0?"CHF":e.indexOf("EUR")>=0?"EUR":e.indexOf("USD")>=0?"USD":"$";function t(e){const t=/(USD|EUR|€|\$|£|zł|CHF|R)\s?(\d{1,}(?:[.,]*\d{3})*(?:[.,]*\d*))|(\d{1,3}(?:[.,]*\d*)*(?:[.,]*\d*)?)\s?(USD|EUR|€|\$|£|zł|CHF|R)/g;let n,r,o,a=[];for(;null!==(o=t.exec(e));){let e=o[2]||o[3];e&&(e=e.replace(/[.](?=\d{3}\b)/g,""),e=e.replace(/[,](?=\d{3}\b)/g,""),e=e.replace(/,/g,"."),a.push(parseFloat(e)))}return a.length>0&&(n=a.reduce(((e,t)=>e<t?e:t)),r=a.reduce(((e,t)=>e>t?e:t))),{prices:a,minValue:n,maxValue:r}}const n=e=>{const n=[];let r,o;return e.length>0&&(e.forEach((e=>{t(e.textContent).prices.forEach((e=>n.push(e)))})),n.length>0&&(r=n.reduce(((e,t)=>e<t?e:t)),o=n.reduce(((e,t)=>e>t?e:t)))),{prices:n,minPrice:r,maxPrice:o}};function r(e){return 0===e.length||!e.trim()}function o(e,t,n){isNaN(+t?.[n])||(e[n]=+t[n])}function a(e){return encodeURIComponent(e.trim().replace(/"/g,"")).replace("/%2F/g","")}const i=(...e)=>{console.log("ext -",...e)},s=(...e)=>{console.log("ext - ERROR -",...e)},d=(e,t,n,r)=>{chrome.runtime.sendMessage({command:"pvv-ext-sendLog",type:e,data:t,addInfo:{message:n,url:r}})},l=(e,t,n,r)=>{d("error_address_parsing - "+e,t,n,r)},c=(e,t,n,r)=>{d("error_address_paste - "+e,t,n,r)},u=e=>{if("string"!=typeof e)return e;if(void 0!==window.DOMParser)return(new DOMParser).parseFromString(e,"text/html");const t=document.implementation.createHTMLDocument("");return t.body.innerHTML=e,t},m=(e,t,n=[])=>{for(const[r,o]of Object.entries(e))n.includes(r)?!t[r]&&o&&(t[r]=o):t[r]=o};const p=(e,t)=>{const n={command:"pvv-ext-setBuyerAddress",buyerAddress:e,useCrossBrowserAddressCopying:t};return new Promise(((e,t)=>{chrome.runtime.sendMessage(n,(n=>{n.success?e(n):t(n)}))}))},y=(e,t)=>{try{const n=new URL(t).searchParams.get(e);return n||""}catch(e){return""}},f=window.location.href,h={origin:window.location.origin,domain:(v=window.location.hostname,v.indexOf(".co.uk")>0?"co.uk":v.indexOf(".ca")>0?"ca":v.indexOf(".it")>0?"it":v.indexOf(".de")>0?"de":v.indexOf(".fr")>0?"fr":v.indexOf(".es")>0?"es":v.indexOf(".com.au")>0?"com.au":v.indexOf(".com.mx")>0?"com.mx":v.indexOf(".com.br")>0?"com.br":v.indexOf(".nl")>0?"nl":v.indexOf(".co.jp")>0?"co.jp":v.indexOf(".in")>0?"in":v.indexOf(".sg")>0?"sg":v.indexOf(".ae")>0?"ae":v.indexOf(".com.tr")>0?"com.tr":v.indexOf(".pl")>0?"pl":v.indexOf(".ie")>0?"ie":v.indexOf(".be")>0?"be":v.indexOf(".ch")>0?"ch":v.indexOf(".at")>0?"at":"com"),amazon:!1,amzSellercentral:!1,ebay:!1,searchList:!1,itemList:!1,buyerAddress:!1,buyerAddress_2018_05:!1,manageOrders:!1,amzDeals:!1,grabley:!1,walmart:!1,totalelement:!1,amzOrderPage:!1,aliexpress:!1,dirRLT:"rtl"===document.dir,language:(e=>e.indexOf(".sa/")>0?"ar":e.indexOf(".fr/")>0?"fr":e.indexOf(".de/")>0?"de":"en")(f),initHosts:function(){document.querySelector("#dealTitle")&&(h.amazon=!0,h.amzDeals=!0),(f.indexOf("sellercentral")>0||document.querySelector("#sc-logo-asset"))&&(h.amazon=!0,h.amzSellercentral=!0),(document.querySelector("#myo-order-details-buyer-address")||document.querySelector('div[data-test-id="shipping-section-buyer-address"]')||document.querySelector("#shipping-section-buyer-address"))&&(h.amazon=!0,h.buyerAddress=!0),document.querySelector('span[data-test-id="order-id-value"]')&&(h.amazon=!0,h.amzOrderPage=!0),(f.toLowerCase().includes("amazon")||document?.title.toLowerCase().includes("amazon"))&&(h.amazon=!0,document.querySelector(".s-result-item")&&(h.searchList=!0),(document.querySelector("#productTitle")||document.querySelector("#detail_bullets_id"))&&(h.itemList=!0),document.querySelector("#myo-order-details-buyer-address")&&(h.buyerAddress=!0)),(f.indexOf(".ebay.")>0||f.indexOf("/Development/amazon-ebay-order/ebay/")>0)&&(h.ebay=!0),f.indexOf("extension.grabley.net")>0&&(h.grabley=!0),f.indexOf("walmart.com")>0&&(h.walmart=!0),f.indexOf("totalelement.com")>0&&(h.totalelement=!0),f.indexOf(".aliexpress.")>0&&(h.aliexpress=!0)},showHosts:function(){for(let e in h)console.log("showHosts - "+e+": "+h[e])}};var v;Object.defineProperty(h,"initHosts",{enumerable:!1}),Object.defineProperty(h,"showHosts",{enumerable:!1}),h.initHosts();function g(e,t){return!!e.active||("mainSwitch"===t||"active"===t||"user_login"===t||"language"===t||"hideItemsWithVariation"===t||"showPrime"===t||"showAsin"===t||"showBuyBox"===t||"showBrand"===t||"showProductInformation"===t||"showCustomerReviewsFilter"===t||"hideAdvertisingBlocks"===t||"buttonSearchOnEbay"===t||"buttonSearchOnEbay_BuyItNow"===t||"buttonSearchOnEbay_ItemLocation_NorthAmerica"===t||"buttonSearchOnWalmart"===t||"getBSR"===t||"showMargin"===t||"amazonFee"===t||"ebay_only_FastAndFree"===t||"buttonSearchOnAmazon"===t||"ebay_button_DefaultFilters"===t||"phone"===t||"ebay_MessageToSeller"===t||"ebay_show_QuantityAvailable"===t||"ebay_show_Delivery"===t||"ebay_show_Returns"===t||"ebay_show_Brand"===t||"ebay_show_QuantityItemsSold"===t||"ebay_hide_ItemsByQuantity"===t||"ebay_hide_ItemsByQuantity_minQuantity"===t||"ebay_show_ItemSpecifics"===t||"walmartAddButtonSearchOnAmazon"===t||"walmartAddButtonSearchOnEbay"===t||"walmartAddButtonSearchOnEbay_BuyItNow"===t||"walmartAddButtonSearchOnEbay_ItemLocation_NorthAmerica"===t||"buyerAddress"===t||"showLog"===t||"ebayOptions"===t||"amz_showQuantityOnProductPage"===t)}const b={mainSwitch:!0,active:!1,language:"en",useCrossBrowserAddressCopying:!1,hidePrime:!1,hideSoldByAmazon:!1,hideItemsWithVariation:!1,onlyCurrentlyUnavailable:!1,hideAdvertisingBlocks:!1,buttonSearchOnWalmart:!0,buttonSearchOnEbay:!0,buttonSearchOnEbay_BuyItNow:!1,buttonSearchOnEbay_ItemLocation_NorthAmerica:!1,showAsin:!0,showBuyBox:!0,getBSR:!0,hideEmptyBSR:!1,maxValBSR:"",minValBSR:"",showBrand:!0,showProductInformation:!0,showCustomerReviewsFilter:!0,showPrime:!0,quickSearchOnEbay:!1,amz_showQuantityOnProductPage:!0,showMargin:!0,amazonFee:15,ebay_button_DefaultFilters:!0,hideDontSold:!1,buttonSearchOnAmazon:!0,ebay_only_FastAndFree:!1,phone:"",ebay_MessageToSeller:"",ebay_show_QuantityAvailable:!0,ebay_show_QuantityItemsSold:!0,ebay_show_Delivery:!0,ebay_show_Returns:!0,ebay_show_Brand:!0,ebay_hide_ItemsByQuantity:!1,ebay_hide_ItemsByQuantity_minQuantity:1,ebay_show_ItemSpecifics:!0,walmartAddButtonSearchOnAmazon:!0,walmartAddButtonSearchOnEbay:!0,walmartAddButtonSearchOnEbay_BuyItNow:!1,walmartAddButtonSearchOnEbay_ItemLocation_NorthAmerica:!1},S=(e,t)=>new Promise((n=>chrome.runtime.sendMessage({command:"pvv-ext-getCacheData",cacheType:t,cacheKey:e},(e=>{n(e)})))),x=(e,t,n)=>{chrome.runtime.sendMessage({command:"pvv-ext-setCacheData",cacheType:t,cacheKey:e,data:n})};function w(e){return t(e,"Canada")||t(e,"Kanada")?"CA":!0===function(e){const t=["APO","FPO","DPO"],n=["AA","AE","AP"];let r=!1,o=!1;for(let a of e)t.includes(a.toUpperCase())&&(r=!0),n.includes(a.toUpperCase())&&(o=!0);if(!0===r&&!0===o)return!0;return!1}(e)?"AA":"US";function t(e,t,n=3){const r=t.trim().replace(/\./g,"").replace(/,/g,"").toUpperCase();let o=e.length-1;for(;o>n;){if(e[o].trim().replace(/\./g,"").replace(/,/g,"").toUpperCase()===r)return!0;o--}return!1}}function A(e){if(!e)return"";const t=e.indexOf("ext.");return-1!==t?e.slice(0,t).trim():e}function q(e,t){const n=(e=>{let t=[];return e.querySelectorAll("span").forEach((e=>{const n=e.textContent.trim();n&&t.push(n)})),t.length<4&&(new Array(...e.children).forEach((e=>e.textContent=",")),t=e.textContent.split(",")),t=t.map((e=>e.trim().replace(/,/g,""))).filter((e=>e.length>0)),t})(e);return t&&n.push("Phone:"+t),L(n,e.textContent,e.innerHTML)}const C=(e,t)=>{let n=[...e.replace(/"/g,"").split(t)];return n=n.map((e=>e.trim())).filter((e=>e.length>0)),n=(e=>{const t=[...e],n=E(w(e));let r=t.length-1;for(;r>1;){const e=t[r].trim();if(e.includes(" ")){const o=e.split(" ");for(let a=0;a<o.length;a++){const i=n.getStateCode(o[a]);if(i){const n=e.lastIndexOf(o[a]),s=e.slice(0,n),d=e.slice(n+o[a].length);return t.splice(r,1,s,i,d),t}}}else if(n.getStateCode(e))return t;r--}return t})(n),n=n.map((e=>e.trim().replace(/,/g,""))).filter((e=>e.length>0)),n};function _(e){let t=[];if(e.includes("Address Type:"))try{t=(e=>{const t=e.replace(/"/g,"").split("Address Type:");if(2!==t.length)throw new Error("address from text - splitByAddressType.length !== 2");const n=[...t[0].split("\n")],r=n.pop().split(", ");if(2!==r.length)throw new Error("address from text - arrCityAndStateZip.length !== 2");n.push(r[0]);const o=r[1].search(" ");if(-1===o)throw new Error("address from text - arrCityAndStateZip - can't search separator");const a=r[1].slice(0,o).trim(),i=r[1].slice(o).trim();if(n.push(a),n.push(i),t[1].includes("Phone:")){const e=t[1].slice(t[1].search("Phone:")).trim();e&&n.push(e)}return n})(e)}catch(e){}if(t.length<4)try{t=C(e,"\t")}catch(e){}if(t.length<4)try{t=C(e,", ")}catch(e){}if(t.length<4)try{t=C(e,"\n")}catch(e){}if(t.length<4)try{t=C(e,";")}catch(e){}return L(t,e)}function L(e,t,n=""){if(e.length<4)throw new Error("arrAddress.length <= 4 (minimum allowed array length)");const r=w(e),o=((e,t)=>{const n={state:"",stateCodeIndex:-1},r=E(t);let o=e.length-1;for(;o>0;){const t=r.getStateCode(e[o]);if(t)return n.state=t,n.stateCodeIndex=o,n;o--}return n})(e,r),a=o.stateCodeIndex,i=o.state;if(!i||-1===a)throw new Error("Can't find the state in arrAddress!");if(a===e.length-1)throw new Error("Can't find the zip-code in arrAddress!");if(a<2)throw new Error("Can't find name or city in arrAddress!");const s=(e=>{let t;return t=n(e,"Phone:"),t||(t=n(e,"Phone number:"),t||(t=n(e,"+1 "),t?"+1 "+t:(t=e.find((e=>e.includes("ext."))),t||"")));function n(e,t){let n;const r=e.find((e=>e.includes(t)));return r&&(n=r.slice(r.indexOf(t)+t.length).trim()),n}})(e),d=A(s),l=(e=>{const t=e[0].split(" ").filter((e=>e.trim().length>0));let n=t.slice(0,t.length-1).join(" "),r=t[t.length-1];return 0===n.length&&0!==r.length&&(n=r,r="."),{fullName:e[0],firstName:n,lastName:r}})(e),c=((e,t)=>{const n=e.filter(((e,n)=>n>0&&n<t-1)),r=n[0]?n[0]:"",o=n.length>1?n.slice(1).join(" "):"";return{addressParts:n,address1:r,address2:o}})(e,a),u={arrAddress:e,text:t,innerHTML:n?`${n} ${s?"<div> phone: "+s+"</div>":""}`:"",country:r,fullName:l.fullName,firstName:l.firstName,lastName:l.lastName,addressParts:c.addressParts,address1:c.address1,address2:c.address2,city:e[a-1],state:i,zip:e[a+1],phoneFull:s,phone:d};return u.innerHTML||(u.innerHTML=function(e){let t="<span style='color: green;'>~ loaded from clipboard ~</span><br>";t+=`<span>${e.fullName}</span><br>`,e.addressParts.forEach((e=>{t+=`<span>${e}</span><br>`})),t+=`<span>${e.city}</span>, <span>${e.state}</span> <span>${e.zip}</span>`,e.phoneFull&&(t+=`<br><span>Phone: ${e.phoneFull}</span>`);return t}(u)),u}function E(e){class t{constructor(e,t,n=[],r={}){this.stateCode=e,this.stateName=t,this.additionalNames=n,this.marketplaceValue=r,this.defaultMarketplaceValue=e.toUpperCase()}getMarketplaceValue(e,t){const n=this.marketplaceValue[e];return n||(t?this.stateName:this.defaultMarketplaceValue)}}const n=function(e){return"CA"===e?[new t("AB","Alberta",[],{amazon:"Alberta"}),new t("BC","British Columbia",["Britanya Kolombiyası"],{amazon:"British Columbia"}),new t("MB","Manitoba",[],{amazon:"Manitoba"}),new t("NB","New Brunswick",["Nouveau-Brunswick","Nouveau - Brunswick","newbrunswick"],{amazon:"New Brunswick"}),new t("NL","Newfoundland and Labrador",["Newfoundland"],{amazon:"Newfoundland"}),new t("NS","Nova Scotia",[],{amazon:"Nova Scotia"}),new t("NU","Nunavut",[],{amazon:"Nunavut"}),new t("NT","Northwest Territories",[],{amazon:"Northwest Territories"}),new t("ON","Ontario",[],{amazon:"Ontario"}),new t("PE","Prince Edward Island",[],{amazon:"Prince Edward Island"}),new t("QC","Quebec",["Québec"],{amazon:"Quebec"}),new t("SK","Saskatchewan",[],{amazon:"Saskatchewan"}),new t("YT","Yukon",[],{amazon:"Yukon"})]:[new t("AA","Armed Forces (AA)",[],{aliexpress:"Other"}),new t("AE","Armed Forces (AE)",[],{aliexpress:"Other"}),new t("AP","Armed Forces (AP)",[],{aliexpress:"Other"}),new t("AL","Alabama"),new t("AK","Alaska"),new t("AZ","Arizona"),new t("AR","Arkansas"),new t("CA","California"),new t("CO","Colorado"),new t("CT","Connecticut"),new t("DE","Delaware"),new t("DC","District Of Columbia"),new t("FL","Florida"),new t("GA","Georgia"),new t("HI","Hawaii"),new t("ID","Idaho"),new t("IL","Illinois"),new t("IN","Indiana"),new t("IA","Iowa"),new t("KS","Kansas"),new t("KY","Kentucky"),new t("LA","Louisiana"),new t("ME","Maine"),new t("MD","Maryland"),new t("MA","Massachusetts"),new t("MI","Michigan"),new t("MN","Minnesota"),new t("MS","Mississippi"),new t("MO","Missouri"),new t("MT","Montana"),new t("NE","Nebraska"),new t("NV","Nevada"),new t("NH","New Hampshire"),new t("NJ","New Jersey"),new t("NM","New Mexico"),new t("NY","New York"),new t("NC","North Carolina"),new t("ND","North Dakota"),new t("OH","Ohio"),new t("OK","Oklahoma"),new t("OR","Oregon"),new t("PA","Pennsylvania"),new t("RI","Rhode Island"),new t("SC","South Carolina"),new t("SD","South Dakota"),new t("TN","Tennessee"),new t("TX","Texas"),new t("UT","Utah"),new t("VT","Vermont"),new t("VA","Virginia"),new t("WA","Washington"),new t("WV","West Virginia"),new t("WI","Wisconsin"),new t("WY","Wyoming"),new t("PR","Puerto Rico"),new t("VI","Virgin Islands"),new t("MP","Northern Mariana Islands"),new t("GU","Guam"),new t("AS","American Samoa"),new t("PW","Palau")]}(e),r=(e,t,r=!1)=>{const o=n.find((t=>t.stateCode.toUpperCase()===e.toUpperCase()));if(o)return o.getMarketplaceValue(t,r)},o=e=>{if("string"!=typeof e)return;const t=e.trim().replace(/\./g,"").replace(/,/g,"").toUpperCase();return n.find((e=>{if(e.stateCode.toUpperCase()===t)return!0;if(e.stateName.toUpperCase()===t)return!0;return!!e.additionalNames.find((e=>e.toUpperCase()===t))}))};return{country:e,states:n,findStateByName:o,getStateCode:e=>{const t=o(e);if(t)return t.stateCode.toUpperCase()},getEbayStateValue:e=>r(e,"ebay"),getAmazonStateValue:e=>r(e,"amazon"),getAliexpressStateValue:e=>r(e,"aliexpress",!0)}}class B extends Error{constructor(e){super(e),this.name="AuthorizationError"}}function P(e){let t="https://extension.grabley.net/en/";return e&&("ru"===e?t="https://extension.grabley.net/":"ua"===e&&(t="https://extension.grabley.net/uk/")),t}function T(e){let t=P(e)+"extension-en/#price";return e&&("ru"===e?t=P(e)+"#price":"ua"===e&&(t=P(e)+"extension-ua/#price")),t}const O=e=>{const t=document.createElement("div");if(t.style="display: none; margin-bottom: 5px;",!e.active){let n="en"===e.language?"Available in the PRO version! Buy Now!":"Достпуно в PRO-версии! Купить сейчас!",r=T(e.language);e.user_login||(n="en"===e.language?"Please login to Grabley":"Авторизируйтесь в Grabley",r=function(e){let t=P(e)+"profile-en";return e&&("ru"===e?t=P(e)+"profile":"ua"===e&&(t=P(e)+"profile-ua")),t}(e.language)),t.innerHTML=`<a href=${r} target="_blank" style="font-size: 14px; color: blue;">${n}</a>`}return t};function N(e,t){if(!e||!t)return;const n=t.parentNode;t.nextSibling&&n?n.insertBefore(e,t.nextSibling):n&&n.appendChild(e)}const I=new Event("click",{bubbles:!0}),k=new Event("change",{bubbles:!0}),M=new Event("input",{bubbles:!0}),R=e=>{e.dispatchEvent(k)},z=(e,t)=>{e.dispatchEvent(new CustomEvent("updateDataEvent",{detail:t}))},$=(e,t=100,n=2e3,r)=>{let o,a=0;const i=new Promise((n=>{o=setInterval((()=>{a++,r&&console.log(`taskPromise - ${r} - iteration: ${a}`);const t=document.querySelector(e);t&&(clearInterval(o),n(t))}),t)})),s=new Promise((e=>{setTimeout((()=>{clearInterval(o),e(null)}),n)}));return Promise.race([i,s])},D=async(e,t,n,r=100,o=2e3,a)=>(e.dispatchEvent(t),await $(n,r,o,a)),H=e=>new Promise((t=>setTimeout(t,e))),F=(e,t)=>{if(!e)return!1;const n=e.textContent.toLowerCase();return RegExp(t.toLowerCase()).test(n)},U=(e,t)=>[].filter.call(e,(e=>F(e,t)));function V(e,t,n=5e3){o();const r=document.createElement("span");function o(){document.querySelectorAll(".pvv-ext-CopyError").forEach((e=>e.remove()))}r.setAttribute("style","color: red; font-size: 12pt; font-weight: bolder"),r.textContent=t,r.className="pvv-ext-CopyError",e.appendChild(r),setTimeout(o,n)}function Q(e,t=" * copied",n=2e3){const r=document.createElement("span");r.setAttribute("style","color: green; font-size: 12pt;"),r.textContent=t,r.className="pvv-ext-CopySuccess",e.appendChild(r),setTimeout((()=>document.querySelectorAll(".pvv-ext-CopySuccess").forEach((e=>e.remove()))),n)}function W(e,t,n){console.log("loadAddressFromClipboard"),navigator.clipboard.readText().then((async r=>{if(0===r.length)return console.log("Clipboard contains no text!"),void V(n,"Error - Clipboard contains no text!");if(r.length>1e3)return console.log("The text on the clipboard is too long!"),void V(n,"Error - Clipboard text is too long!");if(r.length<20)return console.log("The text on the clipboard is too short!"),void V(n,"Error - Clipboard text is too short!");if(r.includes("https://"))return console.log('The text on the clipboard includes link "https://"!'),void V(n,"Error - Clipboard text includes link!");let o;try{o=_(r)}catch(e){console.log(e);const t=`${e.name}: ${e.message}     Stack: ${e.stack}`;return l("text from clipboard",r,t,document.location.href),s("Can't parse buyer's address from text"),void V(n,"Error - Can't parse address from clipboard!")}console.log("new buyerAddress",o),await p(o,!1),e.updateBuyerAddress=!0,t()})).catch((e=>{s("Error reading address from clipboard. "+e),V(n,"Error reading address from clipboard!")}))}function j(e="green",t,n=1500){document.querySelectorAll(".ext-popup-wrap").forEach((e=>e.remove()));let r="rgb(10, 100, 50)",o="rgb(56, 178, 172, 0.9)",a="rgb(56, 178, 172)";"blue"===e?(r="rgb(10, 50, 100)",o="rgb(30, 66, 159, 0.9)",a="rgb(30, 66, 159)"):"grey"===e&&(r="rgb(41, 51, 65)",o="rgb(229, 230, 231, 0.9)",a="rgb(180, 200, 200)");const i=document.createElement("div");i.classList.add("ext-popup-wrap"),i.innerHTML=`<div class="ext-popup">\n          <div class="ext-popup-container">${t}</div>\n        </div>`,document.body.appendChild(i);const s=document.querySelector(".ext-popup");s?.setAttribute("style","z-index: 1000; position: fixed; top: 16px; left: 40%; transition: opacity 400ms ease-in-out;");document.querySelector(".ext-popup-container")?.setAttribute("style",`\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        width: 220px;\n        min-height: 24px;\n        font-size: 14px;\n        color: ${r};\n        background-color: ${o};\n        border: 2px;\n        border-style: solid;\n        border-radius: 3px;\n        border-color: ${a};\n      `),setTimeout((()=>{s.style.opacity=0}),n)}function G(e,t){e?function(e){j("green",e)}("ON - "+t):function(e){j("grey",e)}("OFF - "+t)}function K(...e){b.showLog&&i(...e)}function Z(...e){b.showLog&&K(...e,(new Date).toLocaleTimeString())}const X=(e,t,n)=>{e.getQueryOfferListing=!0;const r=(e=>{const t={sellersCount:0,fbaCount:0,fbmCount:0,amzCount:0,soldByAmazon:!1,prime:!1,totalQuantity:0},n=u(e).querySelector("body"),r=n.querySelectorAll("#aod-sticky-pinned-offer #aod-offer-shipsFrom");t.sellersCount=r.length,t.fbaCount=U(r,"Amazon").length,t.amzCount=U(n.querySelectorAll("#aod-sticky-pinned-offer #aod-offer-soldBy"),"Amazon").length;const o=n.querySelectorAll("#aod-offer-list #aod-offer-shipsFrom");function a(e){return e.querySelectorAll('[id^="aod-offer-qty-component-"] .aod-qty-option').length}return t.sellersCount=t.sellersCount+o.length,t.fbaCount=t.fbaCount+U(o,"Amazon").length,t.amzCount=t.amzCount+U(n.querySelectorAll("#aod-offer-list #aod-offer-soldBy"),"Amazon").length,t.fbaCount-=t.amzCount,t.fbmCount=t.sellersCount-t.fbaCount-t.amzCount,t.fbmCount<0&&(t.fbmCount=0),t.soldByAmazon=t.amzCount>0,t.prime=!!(t.prime||t.fbaCount>0||t.soldByAmazon),n.querySelectorAll("#aod-container #aod-pinned-offer").forEach((e=>t.totalQuantity+=a(e))),n.querySelectorAll("#aod-container #aod-offer").forEach((e=>t.totalQuantity+=a(e))),t})(t);m(r,e),n&&n()};const Y=(e,t)=>{const r=function(e){const t={source_BSR:"-",value_BSR_string:" ",value_BSR:0,category_BSR:"",otherCategoriesBSR:[],buyBox:"-",salersNew:void 0,itemWithVariation:!1,brand:void 0,minPrice:void 0,maxPrice:void 0,partNumber:void 0,itemModelNumber:void 0},r=u(e).querySelector("body"),o=r.querySelectorAll("#twister"),a=r.querySelectorAll("#twister-plus-inline-twister");t.itemWithVariation=o.length+a.length>0,t.buyBox=r.querySelectorAll("#add-to-cart-button").length>0,r.querySelector(".primeUpsellIcon")&&(t.prime=!0);let i=[];0===i.length&&(i=r.querySelectorAll("#prodDetails [href*='/gp/bestsellers/']")),0===i.length&&(i=r.querySelectorAll("#productDetails_detailBullets_sections1 [href*='/gp/bestsellers/']")),0===i.length&&(i=r.querySelectorAll("#detailBulletsWrapper_feature_div [href*='/gp/bestsellers/']")),0===i.length&&(i=r.querySelectorAll("#productDetails_detailBullets_sections1 [href*='/gp/bestsellers/']")),0===i.length&&(i=r.querySelectorAll("#productDetails_detailBullets_sections [href*='/gp/bestsellers/']")),0===i.length&&(i=r.querySelectorAll("#productDetailsTable [href*='/gp/bestsellers/']")),0===i.length&&(i=r.querySelectorAll("#productDetails_db_sections [href*='/gp/bestsellers/']")),0===i.length&&(i=r.querySelectorAll("#detailBullets_feature_div [href*='/gp/bestsellers/']"));let{text_BSR:s,otherCategoriesBSR:d}=function(e){const t={text_BSR:void 0,otherCategoriesBSR:[]};return e&&0!==e.length?(t.text_BSR=y(e[0]?.parentElement?.textContent),e.forEach(((e,n)=>{if(n>0){const n=e?.parentElement?.textContent;n&&t.otherCategoriesBSR.push(n)}})),t):t}(i);if(s||(s=y(r.querySelector("#SalesRank")?.textContent)),s||(s=r.querySelector("#SalesRank .value")?.textContent,s=y(s,0)),s){const e=75;t.source_BSR=s,t.otherCategoriesBSR=d;let n="#"===s.charAt(0)?1:0,r=s.indexOf(" ");t.value_BSR_string=s.substring(n,r).trim(),t.value_BSR=parseInt(t.value_BSR_string.split(",").join("").split(".").join("")),t.category_BSR=s.substring(r).trim(),t.category_BSR.length>e&&(t.category_BSR=t.category_BSR.substr(0,e-3)+"...")}const l=r.querySelectorAll(".prodDetSectionEntry"),c=["Brand","Marke","Marque","Marka","Marca","Marchio","Merk","Varumärke","Üretici","الشركة المصنعة","العلامة التجارية","ブランド"];if(t.brand=f(l,...c),!t.brand){const e=r.querySelector(".po-brand");c.forEach((n=>{e&&e.textContent.includes(n)&&(t.brand=e.textContent.trim().slice(n.length).trim())}))}if(!t.brand){const e="Brand:",n=r.querySelector("#bylineInfo");n&&n.textContent.includes(e)&&(t.brand=n.textContent.trim().slice(e.length).trim())}let m={minPrice:void 0,maxPrice:void 0};const p=r.querySelectorAll("#apex_desktop .aok-offscreen");if(p.length>0)m=n([p[0]]);else{const e=r.querySelectorAll("#apex_desktop .apexPriceToPay");e.length>0&&(m=n(e))}return t.minPrice=m.minPrice,t.maxPrice=m.maxPrice,t.partNumber=f(l,"Part Number","Artikelnummer","Référence","Número da Peça","Parça Numarası","Onderdeelnummer","Número de modelo del producto","Modello","Codice articolo","部品番号"),t.itemModelNumber=f(l,"Item model number","Modellnummer","Número do modelo","Modelnummer item","Identificador de producto del fabricante","Nazwa modelu","Numéro de modèle","Numero modello articolo","製品型番"),t;function y(e,t){if(!e)return;const n=e.toLowerCase().replace(/\{.*\}/g,"").trim();void 0===t&&(t=Math.max(n.search(/\d/),0));const r=function(e,...n){const r=e.length;let o=r;for(let a=0;a<n.length;a++){let i=e.indexOf(n[a],t+1);i=-1===i?r:i,o=Math.min(i,o)}return o}(n,"(see top","(visualizza","(voir","(siehe","(ver");return r>0?n.substring(t,r-1).trim():void 0}function f(e,...t){const n=function(e,...t){let n=null;return e.forEach((e=>{t.forEach((t=>{const r=t.toLowerCase();e.textContent.trim().toLowerCase()===r&&(n=e.parentNode)}))})),n}(e,...t);if(n)return n.querySelector(".prodDetAttrValue")?.textContent.trim()}}(t);m(r,e,["minPrice","maxPrice"]),x(e.asin,"AdditionalInformation",r)},J=chrome.runtime.getURL("img/ebay.png"),ee=chrome.runtime.getURL("img/walmart.png"),te=chrome.runtime.getURL("img/icon-48.png"),ne=chrome.runtime.getURL("img/copy-icon.svg"),re=chrome.runtime.getURL("img/icon-ok.svg"),oe=chrome.runtime.getURL("img/icon-error.svg"),ae=chrome.runtime.getURL("img/icon-48.png"),ie="pvv-ext-FullBSR";let se,de,le=!0;const ce=()=>{const e={search:!1,product:!1,bestsellers:!1,addressSelect:!1};return document.location.href.includes("s?k=")||document.querySelector(".s-result-item")?e.search=!0:document.location.href.includes("/dp/")||document.querySelector("#productTitle")||document.querySelector("#detail_bullets_id")?e.product=!0:document.querySelector("#zg_banner")&&document.querySelector("#gridItemRoot")?e.bestsellers=!0:(document.querySelector("#address-ui-widgets-enterAddressLine1")||document.querySelector("#shipaddress"))&&(e.addressSelect=!0),e};let ue=ce();const me=[],pe=e=>{me.push(e)},ye=e=>me.find((t=>t.asin===e)),fe=()=>me,he=({asin:e,title:t,href:n,qid:r="",prime:o=!1,currentlyUnavailable:a=!1,element:i=null,itemWithVariation:s=!1,sendQueryOfferListing:d=!1,getOfferListingInformation:l=!1,sendQueryAdditionalInformation:c=!1,getQueryOfferListing:u=!1,source_BSR:m="",brand:p,minPrice:y,maxPrice:f,totalQuantity:h,customerRatings:v})=>{const g={asin:e,title:t,href:n,qid:r,prime:o,currentlyUnavailable:a,element:i,itemWithVariation:s,sendQueryOfferListing:d,getOfferListingInformation:l,sendQueryAdditionalInformation:c,getQueryOfferListing:u,source_BSR:m,brand:p,errorFetchAdditionalInformation:!1,errorFetchOfferListingInformation:!1,minPrice:y,maxPrice:f,totalQuantity:h,customerRatings:v};return(e=>{e.hrefOfferListing="/gp/offer-listing/"+e.asin,e.hrefOfferListingWithFilters=e.hrefOfferListing+"/ref=olp_f_primeEligible?ie=UTF8&f_new=true&f_primeEligible=true",e.hrefOfferListingInformation=`/gp/product/ajax/ref=dp_aod_ALL_mbc?asin=${e.asin}&m=&qid=${e.qid}&smid=&sourcecustomerorglistid=&sourcecustomerorglistitemid=&sr=&pc=dp&experienceId=aodAjaxMain`})(g),g},ve=e=>{if(!e)return;let t=e.match(/\/dp\/([A-Z0-9]{10})\//)||[];return void 0!==t[1]?t[1].trim():(t=e.match(/%2Fdp%2F([A-Z0-9]{10})/)||[],void 0!==t[1]?t[1].trim():(t=e.match(/(?:[/dp/]|$)([A-Z0-9]{10})\//)||[],void 0!==t[1]?t[1].trim():void 0))},ge=e=>{let t="";const n=/[\?&]qid=(\d+)/.exec(e);return n&&(t=n[1]),t||""},be=(e="")=>{let t="";const n=document.querySelector("[name=qid]");return n&&(t=n.value.trim()),t||(t=ge(e)),t||(t=y("qid",e)),t||(t=ge(document.URL)),t||(t=y("qid",document.URL)),t},Se=e=>{let t,r,o,a,i,s,d,l="";if(ue.search){const t=e.querySelector("h2 > a.a-link-normal");if(t)a=t.parentElement.innerText.trim(),r=t.getAttribute("href");else{let t=e.querySelector("a.s-access-detail-page");t&&(a=t.getAttribute("title"),r=t.getAttribute("href"))}}if(ue.bestsellers){const t=e.querySelector("a.a-link-normal > span > div");if(t&&(a=t.innerText.trim(),r=t.parentElement.parentElement.getAttribute("href")),!r){const t=e.querySelector(".p13n-sc-uncoverable-faceout");if(t){o=t.id;const e=t.querySelector("span");e&&(a=e.innerText.trim())}}}o||(o=e.getAttribute("data-asin")),!o&&r&&(o=ve(r)),!r&&o&&(r=(e=>`${document.location.origin}/dp/${e}`)(o)),o&&a&&r||(t=`amz getMainData - Can't get item data from ${e}`),l=be(r);const c=e.querySelectorAll('.a-price[data-a-color="base"] .a-offscreen'),u=n(c);i=u.minPrice,s=u.maxPrice;let m=e.querySelector('[data-csa-c-content-id="alf-customer-ratings-count-component"]');return m||(m=e.querySelector('[href*="#customerReviews"]')),m&&(d=+m.textContent.replace(",","").replace(".","")),{error:t,href:r,asin:o,title:a,qid:l,minPrice:i,maxPrice:s,customerRatings:d}},xe=e=>!!e.querySelector(".a-icon-prime"),we=e=>"ar"===e?"لا يوجد عروض متوفرة":"fr"===e?"Actuellement indisponible":"de"===e?"Derzeit nicht verfügbar":"Currently unavailable",Ae=e=>{const t=we(h.language);return F(e,we("en"))||"en"!==h.language&&F(e,t)},qe=(e,t,n)=>{if(e.isDisplayed=!0,t.mainSwitch){if(t.hidePrime&&e.prime&&(e.isDisplayed=!1),t.hideSoldByAmazon&&e.soldByAmazon&&(e.isDisplayed=!1),t.onlyCurrentlyUnavailable&&!e.currentlyUnavailable&&(e.isDisplayed=!1),isFinite(t.maxValBSR)){const n=+t.maxValBSR;n>0&&e.value_BSR>n&&(e.isDisplayed=!1)}if(isFinite(t.minValBSR)){const n=+t.minValBSR;n>0&&e.value_BSR<n&&(e.isDisplayed=!1)}t.hideEmptyBSR&&"-"===e.source_BSR&&(e.isDisplayed=!1),t.hideItemsWithVariation&&e.itemWithVariation&&(e.isDisplayed=!1),n.minPrice&&e.minPrice<n.minPrice&&e.maxPrice<n.minPrice&&(e.isDisplayed=!1),n.maxPrice&&e.minPrice>n.maxPrice&&e.maxPrice>n.maxPrice&&(e.isDisplayed=!1),e.customerRatings&&(n.minCustomerRatings&&e.customerRatings<n.minCustomerRatings&&(e.isDisplayed=!1),n.maxCustomerRatings&&e.customerRatings>n.maxCustomerRatings&&(e.isDisplayed=!1))}},Ce=(e,t)=>{e.isDisplayed?"none"===t.style.display&&(t.style.display=""):"none"!==t.style.display&&(t.style.display="none")};function _e(e,t){if(!e.getOfferListingInformation&&!e.isDisplayed)return;if(e.sendQueryOfferListing)return;e.sendQueryOfferListing=!0;const n=new XMLHttpRequest;n.responseType="text",n.open("GET",e.hrefOfferListingInformation,!0),n.send(),n.addEventListener("load",(()=>{200===n.status?X(e,n.responseText,t):(e.errorFetchOfferListingInformation=!0,console.log("cannot get offer listing information on asin: "+e.asin),chrome.runtime.sendMessage({command:"pvv-ext-sendLog-amz-fetch-error",informationType:"offer-page",sourceUrl:document.location.href,requestUrl:e.href,asin:e.asin,statusCode:n.status}))}))}const Le=(e,t,n)=>{let r=e.querySelector(".pvv-ext-divButtonSearchOnEbay");if(!b.mainSwitch||!b.buttonSearchOnEbay)return void(r&&r.remove());if(r)return;r=document.createElement("div"),r.className="pvv-ext-divButtonSearchOnEbay";const o=a(t);let i="https://www.ebay."+h.domain+"/sch/i.html?&_nkw="+o;b.buttonSearchOnEbay_BuyItNow&&(i+="&LH_BIN=1"),b.buttonSearchOnEbay_ItemLocation_NorthAmerica?i+="&LH_PrefLoc=3":i+="&LH_PrefLoc=98";let s="";n&&n.maxPrice&&(s="search with filters (price): ",i+="&_udlo&_udhi="+n.maxPrice,i.indexOf("&LH_BIN=1")||(i+="&LH_BIN=1")),i+="&_sop=12";r.innerHTML=s+'<a href="'+i+'" target="_blank"><input type="image" img src='+J+' style="height:20px;" class="buttonSearchOnEbay" value="Search on ebay" /></a>',e.querySelector(".pvv-ext-wrap-buttons-ebay").append(r)},Ee=(e,t,n)=>{let r=e.querySelector(".pvv-ext-divButtonSearchOnWalmart");if(!b.mainSwitch||!b.buttonSearchOnWalmart)return void(r&&r.remove());if(null!==r)return;r=document.createElement("div"),r.className="pvv-ext-divButtonSearchOnWalmart";const o=a(t),i="ca"===h.domain?`https://www.walmart.ca/search?q=${o}`:`https://www.walmart.com/search/?query=${o}`;r.innerHTML='<a href="'+i+'" target="_blank"><input type="image" img src='+ee+' style="height:20px;" class="buttonSearchOnWalmart" value="Search on Walmart" /></a>',e.querySelector(".pvv-ext-wrap-buttons-walmart").append(r)};const Be=()=>{document.querySelectorAll(".pvv-ext-FullBSR").forEach((e=>e.remove()))};function Pe(){return b.active?"":`<a target="_blank" style="margin-left:2px;" href=${T(b.language)}>(buy PRO)</a>`}const Te=()=>{if(de||(de=new MutationObserver((()=>setTimeout(Te,1e3))),de.observe(document.body,{childList:!0})),document.querySelectorAll(".pvv-ext-BuyerAddressContainer").forEach((e=>e.remove())),!b.mainSwitch)return;h.updateBuyerAddress=!1;let e=document.querySelector("#address-ui-address-form");e||(e=document.querySelector('.a-popover[aria-hidden="false"] #address-ui-checkout-form')),e&&function(){const t=document.createElement("div");t.classList.add("pvv-ext-BuyerAddressContainer"),t.style="margin-bottom: 10px;",e.prepend(t);const n=O(b);t.append(n);const r=document.createElement("div");r.innerHTML='Address (<a id="load-address-from-clipboard" style="cursor: pointer">load from clipboard</a>):',t.appendChild(r),e.querySelectorAll("#load-address-from-clipboard").forEach((e=>{e.addEventListener("click",(()=>{W(h,Te,i)}))}));const o=document.createElement("div");b.buyerAddress.innerHTML?o.innerHTML=b.buyerAddress.innerHTML:o.textContent=b.buyerAddress.text;t.appendChild(o);const a=document.createElement("button");a.type="button",a.innerHTML=`<img src="${te}" style="height: 18px;"/> <span> Paste address </span>`,a.style="margin: 0px; margin-bottom: 5px; margin-right: 10px; padding: 5px; padding-right: 10px;",a.onclick=d,a.classList.add("pvv-ext-AddressButton"),t.prepend(a);const i=document.createElement("div");async function d(){if(!b.active)return n.style="display: block;",void n.scrollIntoView({block:"center",behavior:"smooth"});try{await l()}catch(e){const t=`${e.name}: ${e.message}     Stack: ${e.stack}`;chrome.runtime.sendMessage({command:"pvv-ext-sendLog",type:"error_address_pastingError",data:"Can't paste the address (amazon)",addInfo:{message:t,url:document.location.href}}),s("Can't paste the address")}}async function l(){const t=e.querySelector("#address-ui-widgets-countryCode-dropdown-nativeId");t.value===b.buyerAddress.country?u():(m(t,b.buyerAddress.country),R(t),await c(2e3))}function c(e){return new Promise(((t,n)=>{setTimeout((()=>{u(),t()}),e)}))}function u(){const t=e.querySelector("#address-ui-widgets-enterAddressFullName"),n=e.querySelector("#address-ui-widgets-enterAddressLine1"),r=e.querySelector("#address-ui-widgets-enterAddressLine2"),o=e.querySelector("#address-ui-widgets-enterAddressCity"),a=e.querySelector("#address-ui-widgets-enterAddressStateOrRegion-dropdown-nativeId"),i=e.querySelector("#address-ui-widgets-enterAddressPostalCode"),s=e.querySelector("#address-ui-widgets-enterAddressPhoneNumber");m(t,b.buyerAddress.fullName),m(n,b.buyerAddress.address1),m(r,b.buyerAddress.address2),m(o,b.buyerAddress.city);m(a,E(b.buyerAddress.country).getAmazonStateValue(b.buyerAddress.state)),m(i,b.buyerAddress.zip);m(s,""===b.phone?b.buyerAddress.phone:b.phone)}function m(e,t){e.value=t||"",R(e)}i.classList.add("pvv-ext-msg-wrapper"),t.appendChild(i)}()};function Oe(){return document.querySelector('[aria-label="Include Out of Stock"] input[type="checkbox"]')}const Ne="pvv-ext-filters",Ie="pvv-ext-customer-reviews-filter",ke="pvv-ext-customer-reviews-min",Me="pvv-ext-customer-reviews-max",Re="pvv-ext-price-filter",ze="pvv-ext-price-min",$e="pvv-ext-price-max",De={createMainDiv:()=>{const e=document.createElement("div"),t=P(b.language);return e.className="pvv-ext-mainDiv",e.innerHTML=`<div class="pvv-ext-wrap"\n                            style="margin-top: 5px; margin-bottom: 5px; padding-left: 5px; padding-right: 5px;\n                            border-style: solid; border-width: 1px; border-radius: 5px; box-sizing: border-box; border-color: rgb(220, 220, 220)">\n                            <div class="pvv-ext-wrap-buttons">\n                                <div class="pvv-ext-wrap-buttons-ebay" style="margin: 2px; display: inline-block;"></div>\n                                <div class="pvv-ext-wrap-buttons-walmart" style="margin: 2px; display: inline-block;"></div>\n                            </div>\n                            <div class="pvv-ext-wrap-asin"></div>\n                            <div class="pvv-ext-wrap-BSR" style="position: relative;"></div>\n                            <div class="pvv-ext-wrap-BuyBox"></div>\n                            <div class="pvv-ext-wrap-sellers"></div>\n                            <div class="pvv-ext-wrap-TotalQuantity"></div>\n                            <div class="pvv-ext-wrap-Brand"></div>\n                            <div class="pvv-ext-wrap-ProductInformation"></div>\n                            <div class="pvv-ext-wrap-Price"></div>\n                            <div class="pvv-ext-wrap-ProductDetailsLink"></div>\n                            <div class="pvv-ext-wrap-footer" style="height: 18px;">\n                                <div class="pvv-ext-wrap-footer-grabley" style="display: none;">\n                                    <div style="display: flex; justify-content: flex-end; opacity: 0.5;">\n                                        <a href=${t} target="_blank" style="text-decoration: none; color: inherit;">\n                                            <div style="display: flex; justify-content: flex-end; align-items: center;">\n                                                <div style="font-size: 12px; margin-right: 2px;">by Grabley </div>\n                                                <img src=${ae} style="width: 14px; height: 14px">\n                                            </div>\n                                        </a>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>`,e.addEventListener("mouseenter",(e=>{e.target.querySelector(".pvv-ext-wrap-footer-grabley").setAttribute("style","display: block")})),e.addEventListener("mouseleave",(e=>{e.target.querySelector(".pvv-ext-wrap-footer-grabley").setAttribute("style","display: none")})),e},addSearchButtons:(e,t,n)=>{Le(e,t,n),Ee(e,t,n)},addASIN:function(e,t){let n=e.querySelector(".pvv-ext-showAsin");if(!b.showAsin)return void(n&&n.remove());if(n)return;n=document.createElement("div"),n.className="pvv-ext-showAsin",n.innerHTML=`<span style="font-size: 10pt;">ASIN ${h.dirRLT?"&rlm;":""}: ${t.asin} </span>\n                            <input class="btnCopyToClipboard"\n                                type="image"\n                                img src=${ne}\n                                style="height: 12px; margin-left: 2px"\n                                data-ext-asin=${t.asin}\n                            />`,n.querySelector(".btnCopyToClipboard").addEventListener("click",(e=>{const t=e.target,n=t?.dataset?.extAsin;n&&navigator.clipboard.writeText(n).then((()=>{t.src=re,setTimeout((()=>{t.src=ne}),1500)})).catch((e=>{t.src=oe,setTimeout((()=>{t.src=ne}),2e3),s("Error copying ASIN to clipboard. "+e)}))})),e.querySelector(".pvv-ext-wrap-asin").append(n)},removeFullBSR:Be,addBSR:function(e,t){let n=e.querySelector(".pvv-ext-BSR");if(b.getBSR){if(n||(n=document.createElement("div"),n.setAttribute("data-empty","#"),n.setAttribute("style","margin:0; color:#000000; font-size:9pt;"),n.className="pvv-ext-BSR",n.innerHTML="# loading...",e.querySelector(".pvv-ext-wrap-BSR").append(n)),(t.errorFetchAdditionalInformation||t.value_BSR_string)&&"#"===n.getAttribute("data-empty")){if(n.setAttribute("data-empty","not empty"),t.errorFetchAdditionalInformation){const e="# can't fetch product data";return void(n.innerHTML=`<span> <b style="color:#d00000;font-size:10pt;"> ${e} </span>`)}n.innerHTML='<a> <span> <b style="color:#d00000;font-size:12pt;">#'+t.value_BSR_string+"</b>&nbsp;"+t.category_BSR+"</span> </a>",t.otherCategoriesBSR&&t.otherCategoriesBSR.length>0&&(n.querySelector("a").onclick=e=>{e.stopPropagation(),Be();const r=document.createElement("div");r.className=ie,r.setAttribute("style","font-size:10pt; color:#FFFFFF; border-radius:5px; padding:10px; background-color:rgba(0,0,0,0.8);"),t.otherCategoriesBSR.forEach((e=>{r.innerHTML+=e+"<br>"})),r.style.position="absolute",r.style.left="10px",r.style.top="20px",r.style.zIndex="100",N(r,n)})}}else n&&n.remove()},addBuyBox:function(e,t){let n=e.querySelector(".pvv-ext-BuyBox");b.showBuyBox?(n||(n=document.createElement("div"),n.setAttribute("data-empty","#"),n.setAttribute("style","margin:0; color:#000000; font-size:9pt;"),n.className="pvv-ext-BuyBox",n.innerHTML="#",e.querySelector(".pvv-ext-wrap-BuyBox").append(n)),void 0!==t.buyBox&&"#"===n.getAttribute("data-empty")&&(n.setAttribute("data-empty","not empty"),t.buyBox?n.innerHTML='<span> <b style="color:#0066c0;font-size:10pt;">BuyBox</b></span>':t.buyBox||null!=t.value_BSR&&0!=t.value_BSR?n.innerHTML='<span> <b style="color:#00a000;font-size:10pt;">It has no BuyBox</b></span>':n.innerHTML="")):n&&n.remove()},addPrime:function(e,t){let n=e.querySelector(".pvv-ext-Prime");if(b.showPrime){if(n||(n=document.createElement("div"),n.setAttribute("data-empty","#"),n.setAttribute("style","margin:0; color:#000000; font-size:9pt;"),n.className="pvv-ext-Prime",n.innerHTML="#",e.querySelector(".pvv-ext-wrap-sellers").append(n)),(t.errorFetchOfferListingInformation||t.getQueryOfferListing)&&"#"===n.getAttribute("data-empty")){n.setAttribute("data-empty","not empty");let e="";t.prime&&(e+='<span><b style="color:#4fa3c3;font-size:10pt;">Prime</b></span>'),t.soldByAmazon&&(e+=r(e)?"":" / ",e+='<span><b style="color:#f0c14b;font-size:10pt;">Amazon</b></span>'),t.fbaCount&&(e+=r(e)?"":" / ",e+='<span><b style="color:#d00000;font-size:10pt;">FBA '+t.fbaCount+(t.sellersCount>9?"+":"")+"</b></span>"),t.fbmCount&&(e+=r(e)?"":" / ",e+='<span><b style="color:#4fa3c3;font-size:10pt;">FBM '+t.fbmCount+(t.sellersCount>9?"+":"")+"</b></span>"),t.errorFetchOfferListingInformation&&(e+='<span><b style="color:#d00000;font-size:10pt;"># can\'t fetch offer data</b></span>'),n.innerHTML=`<a href=${t.hrefOfferListingWithFilters} target="_blank">${e}</a>`}}else n&&n.remove()},addProductDetailsLink:function(e,t){const n="pvv-ext-ProductDetailsHref";let r,o=e.querySelector("#"+n);if(o&&o.remove(),!b.mainSwitch)return;if(!t.href)return;if(document.querySelector("#prodDetails")?r="prodDetails":document.querySelector("#detail-bullets")?r="detail-bullets":document.querySelector("#detailBullets_feature_div")&&(r="detailBullets_feature_div"),void 0===r)return;const a=document.createElement("a");a.setAttribute("href","#"+r),a.id=n,a.innerHTML="Product information/details",e.querySelector(".pvv-ext-wrap-ProductDetailsLink").append(a)},addBrand:function(e,t){let n=e.querySelector(".pvv-ext-Brand");b.showBrand?(n||(n=document.createElement("div"),n.setAttribute("data-empty","#"),n.setAttribute("style","margin:0; color:#000000; font-size:10pt;"),n.className="pvv-ext-Brand",e.querySelector(".pvv-ext-wrap-Brand").append(n)),t.brand&&"#"===n.getAttribute("data-empty")&&(n.setAttribute("data-empty","not empty"),n.innerHTML=`<b>Brand${h.dirRLT?"&rlm;":""}:</b><span> ${t.brand}</span>`)):n&&n.remove()},addProductInformation:function(e,t){let n=e.querySelector(".pvv-ext-ProductInformation");b.showProductInformation?(n||(n=document.createElement("div"),n.setAttribute("data-empty","#"),n.setAttribute("style","margin:0; color:#000000; font-size:10pt;"),n.className="pvv-ext-ProductInformation",e.querySelector(".pvv-ext-wrap-ProductInformation").append(n)),(t.partNumber||t.itemModelNumber)&&"#"===n.getAttribute("data-empty")&&(n.setAttribute("data-empty","not empty"),n.innerHTML="",t.partNumber&&(n.innerHTML+=`<div><b>Part number${h.dirRLT?"&rlm;":""}:</b><span> ${t.partNumber}</span></div>`),t.itemModelNumber&&(n.innerHTML+=`<div><b>Model number${h.dirRLT?"&rlm;":""}:</b><span> ${t.itemModelNumber}</span></div>`))):n&&n.remove()},addPriceData:function(e,t){const n=e.querySelector(".pvv-ext-wrap-Price");n&&(t.minPrice&&n.getAttribute("data-min-price")!==t.minPrice.toString()&&n.setAttribute("data-min-price",t.minPrice),t.maxPrice&&n.getAttribute("data-max-price")!==t.maxPrice.toString()&&n.setAttribute("data-max-price",t.maxPrice))},addPrice:function(e,t){let n=e.querySelector(".pvv-ext-Price");if(n||(n=document.createElement("div"),n.setAttribute("data-empty","#"),n.setAttribute("style","margin:0; color:#000000; font-size:10pt;"),n.className="pvv-ext-Price",e.querySelector(".pvv-ext-wrap-Price").append(n)),t.minPrice&&"#"===n.getAttribute("data-empty")){n.setAttribute("data-empty","not empty");let e=""+t.minPrice;t.minPrice!==t.maxPrice&&(e+=" - "+t.maxPrice),n.innerHTML=`<b>Price:</b> $ ${e}`}},addBtnPasteAddress:Te,addBtnCopyBuyerAddress:function(){const e="pvv-ext-divButtonCopyBuyerAddress";if(!b.mainSwitch)return void document.querySelectorAll(".pvv-ext-divButtonCopyBuyerAddress").forEach((e=>e.remove()));if(document.querySelector(".pvv-ext-divButtonCopyBuyerAddress"))return;let t=document.querySelector("#myo-order-details-buyer-address");if(t||(t=document.querySelector('div[data-test-id="shipping-section-buyer-address"]'),t||(t=document.querySelector("#shipping-section-buyer-address"))),!t)return;const n=document.createElement("div");t.parentElement.insertBefore(n,t),n.style="margin-bottom: 5px;",n.classList.add(e);const r=document.createElement("input");r.classList.add(e),r.classList.add("pvv-ext-AddressButton"),n.appendChild(r),r.type="button",r.value="Grabley - Copy address",r.onclick=async function(){r.disabled=!0;let e="";const o=document.querySelector('span[data-test-id="shipping-section-phone"]');let a;o&&(e=o.innerText.trim());try{a=q(t,e)}catch(e){console.log(e);const r=`${e.name}: ${e.message}     Stack: ${e.stack}`;return l("from amz page",t.outerHTML,r,document.location.href),s("Can't parse buyer's address"),void V(n," *** ! copy error ! ***")}const i=[...a.arrAddress,a.phone,void 0].join("\t");navigator.clipboard.writeText(i).then((()=>{})).catch((e=>{s("Error copying address to clipboard. "+e)}));try{await p(a,b.active&&b.useCrossBrowserAddressCopying),Q(n," * copied")}catch(e){V(n," * cross-browser copying error *")}finally{setTimeout((()=>r.disabled=!1),700)}}},hideAdvertisingBlocks:function(){b.mainSwitch&&(b.hideAdvertisingBlocks||b.onlyCurrentlyUnavailable||b.hidePrime)&&(document.querySelectorAll('[data-asin=""]').forEach((e=>{e.classList.contains("a-section")&&!e.querySelector(".sbv-ad-content-container")||(e.style.display="none")})),document.querySelectorAll("#rhf").forEach((e=>{e.style.display="none"})),document.querySelectorAll("#ad").forEach((e=>{e.style.display="none"})),document.querySelectorAll("[data-ad-details]").forEach((e=>{e.style.display="none"})))},getCheckboxIncludeOutOfStock:Oe,turnOffOnlyCurrentlyUnavailableClickCallback:function(){const e=Oe();e&&b.mainSwitch&&b.onlyCurrentlyUnavailable&&e.checked&&(e=>{const t={};t[e]=!1,chrome.storage.local.set(t)})("onlyCurrentlyUnavailable")},addPriceFilter:(e,t)=>{const n=Re,r=e?.querySelector("#"+n);if(!r)return;if(!b.mainSwitch||!t)return void(0!==r.children.length&&(r.setAttribute("style","margin-bottom: 0px"),r.innerHTML=""));if(0!==r.children.length)return;const o=ze,a=$e,i="pvv-ext-clear-price-filters-btn";r.setAttribute("style","margin-bottom: 14px"),r.innerHTML=`\n        <div><img src=${ae} style="width: 14px; height: 14px; margin-right: 5px;">Price  filter:</div>\n        <div style="display: flex; align-items: center;">\n            <input type="text" maxlength="9" id="${o}" placeholder="Min" name="${o}" class="a-input-text a-spacing-top-mini" style="width: 70px;">\n            <input type="text" maxlength="9" id="${a}" placeholder="Max" name="${a}" class="a-input-text a-spacing-top-mini" style="width: 70px;">\n            <span class="a-button a-spacing-top-mini a-button-base s-small-margin-left" style="margin-left: 10px;">\n                <span class="a-button-inner">\n                    <span class="a-button-text" aria-hidden="true" id=${i}>X Clear</span>\n                </span>\n            </span>\n        </div>`;const s=r.querySelector(`#${o}`),d=r.querySelector(`#${a}`),l=sessionStorage.getItem("pvv-ext-min-price"),c=sessionStorage.getItem("pvv-ext-max-price");s&&(l&&(s.value=l),s.addEventListener("input",(e=>{sessionStorage.setItem("pvv-ext-min-price",e.target.value)}))),d&&(c&&(d.value=c),d.addEventListener("input",(e=>{sessionStorage.setItem("pvv-ext-max-price",e.target.value)})));const u=r.querySelector("#"+i);u&&u.addEventListener("click",(()=>{s&&(s.value=""),d&&(d.value=""),sessionStorage.removeItem("pvv-ext-min-price"),sessionStorage.removeItem("pvv-ext-max-price")}))},getPageOptions:()=>{let e,t,n,r;const o=document.querySelector(`#${ze}`),a=document.querySelector(`#${$e}`);o&&o.value&&(e=+o.value.replace(",",".")),a&&a.value&&(t=+a.value.replace(",","."));const i=document.querySelector(`#${ke}`),s=document.querySelector(`#${Me}`);return i&&i.value&&(n=+i.value.replace(",",".")),s&&s.value&&(r=+s.value.replace(",",".")),{minPrice:e,maxPrice:t,minCustomerRatings:n,maxCustomerRatings:r}},addOffersAvailableQuantity:function e(){let t=0;const n=document.querySelector("#aod-offer-list");if(!n)return se&&se.disconnect(),void document.querySelectorAll(".pvv-ext-wrap-qty").forEach((e=>{e.remove()}));function r(e){if(e.querySelector(".pvv-ext-wrap-qty"))return;const n=e.querySelector('[name="submit.addToCart"]');if(!n)return;const r=1+e.querySelectorAll('[id^="aod-offer-qty-component-"] .aod-qty-option').length,o=b.active||t<2;t++;const a=o?r:"",i=document.createElement("div");i.className="pvv-ext-wrap-qty",i.innerHTML=`<div style="display: flex; justify-content: flex-end; align-items: center; margin-top: 5px; margin-right: 4px;">\n            <img src=${ae} style="width: 16px; height: 14px; margin-right: 4px;">\n            <div style="font-size: 14px;">Qty: ${a}</div>${Pe()}\n        </div>`,n.parentElement.parentElement.parentElement.after(i)}se||(se=new MutationObserver(e)),se.observe(n,{childList:!0}),document.querySelectorAll("#aod-container #aod-pinned-offer").forEach((e=>r(e))),document.querySelectorAll("#aod-container #aod-offer").forEach((e=>r(e)))},addTotalOffersAvailableQuantity:function(e,t,n){let r=e.querySelector(".pvv-ext-total-quantity");if(r||(r=document.createElement("div"),r.setAttribute("data-empty","#"),r.setAttribute("style","margin:0; color:#000000; font-size:9pt;"),r.className="pvv-ext-total-quantity",e.querySelector(".pvv-ext-wrap-TotalQuantity").append(r)),t.totalQuantity&&"#"===r.getAttribute("data-empty")){r.setAttribute("data-empty","not empty");const e=n?t.totalQuantity+(t.sellersCount>9?"+":""):"show",o=`<span style="color:#000000; font-size:10pt;"><b>Qty${h.dirRLT?"&rlm;":""}:</b> ${e}</span>`;r.innerHTML=`<a href=${t.hrefOfferListingWithFilters} target="_blank">${o}</a> ${Pe()}`}},addCustomerReviewsFilter:e=>{const t=Ie,n=e?.querySelector("#"+t);if(!n)return;if(!b.mainSwitch||!b.showCustomerReviewsFilter)return void(0!==n.children.length&&(n.setAttribute("style","margin-bottom: 0px"),n.innerHTML=""));if(0!==n.children.length)return;const r=ke,o=Me,a="pvv-ext-clear-customer-reviews-filters-btn";n.setAttribute("style","margin-bottom: 14px"),n.innerHTML=`\n        <div><img src=${ae} style="width: 14px; height: 14px; margin-right: 5px;">Customer reviews filter:</div>\n        <div style="display: flex; align-items: center;">\n            <input type="text" maxlength="9" id="${r}" placeholder="Min" name="${r}" class="a-input-text a-spacing-top-mini" style="width: 70px;">\n            <input type="text" maxlength="9" id="${o}" placeholder="Max" name="${o}" class="a-input-text a-spacing-top-mini" style="width: 70px;">\n            <span class="a-button a-spacing-top-mini a-button-base s-small-margin-left" style="margin-left: 10px;">\n                <span class="a-button-inner">\n                    <span class="a-button-text" aria-hidden="true" id=${a}>X Clear</span>\n                </span>\n            </span>\n        </div>`;const i=n.querySelector(`#${r}`),s=n.querySelector(`#${o}`),d=sessionStorage.getItem("pvv-ext-min-customer-reviews"),l=sessionStorage.getItem("pvv-ext-max-customer-reviews");i&&(d&&(i.value=d),i.addEventListener("input",(e=>{sessionStorage.setItem("pvv-ext-min-customer-reviews",e.target.value)}))),s&&(l&&(s.value=l),s.addEventListener("input",(e=>{sessionStorage.setItem("pvv-ext-max-customer-reviews",e.target.value)})));const c=n.querySelector("#"+a);c&&c.addEventListener("click",(()=>{i&&(i.value=""),s&&(s.value=""),sessionStorage.removeItem("pvv-ext-min-customer-reviews"),sessionStorage.removeItem("pvv-ext-max-customer-reviews")}))},addFiltersWrap:e=>{const t=e.querySelector("#"+Ne);if(!b.mainSwitch)return void(t&&t.remove());if(t)return t;const n=document.createElement("div");return n.id=Ne,n.setAttribute("style","margin-bottom: 14px"),n.innerHTML=`\n        <div id="${Ie}"></div>\n        <div id="${Re}"></div>\n        <hr aria-hidden="true" class="a-divider-normal" style="margin-top: 14px; margin-bottom: 14px;">`,e.prepend(n),n}},He={parsingInterval:700,throttlingTimes:1},Fe={timerId:void 0,queue:[],queueAdditional:[],throttlingCount:0,add(e){Fe.queue.find((t=>t.id===e.id))||(Fe.remove(e),Fe.queue.push(e))},addToAdditionalQueue(e){Fe.queueAdditional.find((t=>t.id===e.id))||(Fe.remove(e),Fe.queueAdditional.push(e))},remove(e){Fe.queue=Fe.queue.filter((t=>t.id!==e.id)),Fe.queueAdditional=Fe.queueAdditional.filter((t=>t.id!==e.id))},removeAll(){Fe.queue=[],Fe.queueAdditional=[]},checkOptionsChanges(){const e=b?.ebayOptions;e&&(e?.parsingInterval&&e.parsingInterval!==He.parsingInterval&&(Fe.stop(),Z("set parsing interval",e.parsingInterval)),o(He,e,"parsingInterval"),o(He,e,"throttlingTimes"))},isBlocked(){const e=b?.ebayOptions?.parsingBlockTime;return!!(e&&e>(new Date).getTime())&&(K("block parsing until time:",new Date(e).toLocaleTimeString()),!0)},blockParsing(){Fe.stop(),chrome.runtime.sendMessage({command:"pvv-ext-sendLog-ebay-block-parsing",currentEbayOptions:He,informationType:"product-page",sourceUrl:document.location.href})},start(){Fe.checkOptionsChanges(),Fe.isBlocked()?Fe.stop():Fe.timerId||(Z("start parsing"),Fe.timerId=setInterval(Fe.parse,He.parsingInterval))},stop(){Fe.timerId&&(Z("stop parsing"),clearInterval(Fe.timerId),Fe.timerId=void 0)},getNextItem(){let e=Fe.queue.shift();return e||(e=Fe.queueAdditional.shift()),e},parse(){if(Fe.isBlocked())return void Fe.stop();let e=Fe.queue.shift();if(!e){if(Fe.throttlingCount++,!(Fe.throttlingCount>He.throttlingTimes))return;Fe.throttlingCount=0,e=Fe.queueAdditional.shift()}e&&(e.sentRequest?Fe.parse():Fe.sendQuery(e))},sendQuery:async function(e){e.sentRequest=!0,Z("send query: "+e.id),fetch(e.href).then((t=>{if(!t.ok)throw Fe.logError(e,t.status,"response is not ok"),403===t.status&&Fe.blockParsing(),new Error(`Response status ${t.status}!   url: ${e.href}`);return t.text()})).then((t=>{const n=function(e){const t={receivedResponse:!0,quantityAvailableTxt:"-",quantitySoldTxt:"-",quantity:1,deliveryTxt:"-",returnsTxt:"-",brand:"not found",itemSpecifics:{brand:"",manufacturer:"",type:"",model:"",mpn:"",upc:"",ean:""}},n=u(e).querySelector("body"),r=(e=>{const t=/"maxValue":"([^"]+)"/,n=e.match(t);if(n&&n[1])return n[1];return null})(e);if(isNaN(parseInt(r,10))){let e=n.querySelector(".d-quantity__availability span");if(e||(e=(o=n.querySelectorAll("#qtySubTxt"))[o.length-1]),e){const n=e.innerText.trim();n&&(t.quantityAvailableTxt=n,t.quantity=(e=>{const t=e.match(/\d+/);if(t)return+t[0];const n=new Map;n.set("last one",1),n.set("last two",2),n.set("last three",3);for(const[t,r]of n)if(e.toLowerCase().includes(t.toLowerCase()))return r;return-1})(n))}}else t.quantityAvailableTxt=r,t.quantity=+r;var o;1===t.quantity&&"-"===t.quantityAvailableTxt&&(t.quantityAvailableTxt="1");let a=n.querySelector(".x-quantity__availability span.ux-textspans:last-child");a||(a=n.querySelector('.x-quantity__availability a[data-testid="ux-action"] span'));a||(a=n.querySelector(".d-quantity__availability span.ux-textspans:last-child"));a||(a=n.querySelector('.d-quantity__availability a[data-testid="ux-action"] span'));if(a){const e=["sold","verkauft","vendidos","vendus","venduti","sprzedane","verkocht"],n=a?.innerText?.toLowerCase()?.trim();if(n){const r=e.find((e=>n.includes(e)));r&&(t.quantitySoldTxt=n.replace(r,"").replace(":","").trim())}}let i,s=n.querySelector("#delSummary .vi-acc-del-range")?.innerText;s||(s=n.querySelector("#delSummary div div")?.innerText);s||(s=n.querySelector("#delSummary div")?.innerText);if(!s){const e=n.querySelector(".ux-labels-values--deliverto .ux-labels-values__values.col-9");if(e){s=e.innerText.trim();const t=s.indexOf(" to ");-1!==t&&(s=s.slice(0,t)),s=s.replace("Estimated between","")}}if(!s){const e=n.querySelector(".ux-labels-values--shipping .ux-labels-values__values.col-9");if(e){s=e.innerText.trim();const t="Get it between",n=s.indexOf(t);-1!==n&&(s=s.slice(n));const r=s.indexOf(" to ");-1!==r&&(s=s.slice(0,r)),s=s.replace(t,"")}}if(s){const e=48;s.length>e&&(s=s.slice(0,e)+"..."),t.deliveryTxt=s.trim()}i||(i=n.querySelector(".ux-labels-values--returns .ux-labels-values__values.col-9 > div > div > span"));i||(i=n.querySelector("#vi-ret-accrd-txt"));i||(i=n.querySelector(".ux-labels-values__values-content > div > span"));i||(i=n.querySelector(".vim.x-returns-minview .ux-labels-values__values-content > div > span"));i&&(t.returnsTxt=i.innerText.trim());const d=l(n);if(m(d,t.itemSpecifics),t.itemSpecifics?.brand)t.brand=t.itemSpecifics.brand;else{let e;e||(e=n.querySelector('[itemprop="brand"] > [itemprop="name"]')),e||(e=U(n.querySelectorAll(".ux-labels-values__labels"),"Brand")[0]?.nextSibling),e||(e=U(n.querySelectorAll(".ux-labels-values__labels"),"Marke")[0]?.nextSibling),e||(e=U(n.querySelectorAll(".ux-labels-values__labels"),"Marque")[0]?.nextSibling),e&&(t.brand=e.innerText.trim())}return t;function l(e){const t={},n=(e,t)=>{const n=e.querySelector(`.ux-labels-values--${t} .ux-labels-values__values`);if(n){return"does not apply"===n.textContent.trim().toLowerCase()?null:n.textContent.trim()}return null};return t.brand=n(e,"brand"),t.brand||(t.brand=n(e,"marke")),t.brand||(t.brand=n(e,"marque")),t.manufacturer=n(e,"manufacturer"),t.type=n(e,"type"),t.model=n(e,"model"),t.mpn=n(e,"mpn"),t.upc=n(e,"upc"),t.ean=n(e,"ean"),t}}(t);m(n,e),z(e.element,e),x(e.id,"ProductInformation",n)})).catch((e=>{s(e.message)}))},logError(e,t,n){chrome.runtime.sendMessage({command:"pvv-ext-sendLog-ebay-fetch-error",informationType:"product-page",sourceUrl:document.location.href,requestUrl:e.href})}};chrome.runtime.onMessage.addListener((function(e,t,n){"pvv-ext-onActivatedTabChanged"===e.command&&(e.isActiveTab?Fe.start():Fe.stop())}));const Ue=chrome.runtime.getURL("img/amazon.png"),Ve=chrome.runtime.getURL("img/icon-48.png"),Qe=(()=>{const e={};return document.querySelector("#Results")||document.querySelector("#ListViewInner")||document.querySelector(".s-item")?e.search=!0:document.querySelector("#itemTitle")||document.querySelector('[data-testid="x-item-title"]')?e.product=!0:document.querySelector(".module.shipping-address.auto-address-container")&&(e.checkout=!0),e})(),We=[],je=e=>We.find((t=>t.id===e)),Ge=e=>{let t,n=e.querySelector("a.s-item__link");return n||(n=e.querySelector(".lvtitle a")),n&&(t=n.href),!t&&b.showLog&&i("ebay - cannot get link from element",e),t},Ke=(e,t)=>{if(e){const t=e.match(/\/[0-9]{12}/);if(t)return t[0].substring(1)}if(t){const e=t.getAttribute("listingid");if(e)return e}b.showLog&&i("ebay - cannot get itemId from href: "+e)},Ze=()=>!!b.mainSwitch&&!!(b.ebay_show_QuantityAvailable||b.ebay_show_QuantityItemsSold||b.ebay_show_Returns||b.ebay_show_Delivery||b.ebay_show_Brand||b.ebay_hide_ItemsByQuantity||b.ebay_show_ItemSpecifics),Xe=(e,t)=>{const n="pvv-ext-AdditionalInformation",r=e.querySelector("."+n);if(r&&r.remove(),!Ze())return;const o=document.createElement("span");o.classList.add(n),o.classList.add("s-item__detail"),o.classList.add("s-item__detail--secondary");let a=e.querySelector(".s-item__details-section--secondary");if(a||(a=e.querySelector(".s-item__details.clearfix"),a||(a=e.querySelector(".lvdetails"))),a){a.prepend(o);const e=document.createElement("div");e.setAttribute("style","margin:0px; line-height:18px;margin-bottom:8px;"),e.classList.add(n),e.classList.add("pvv-ext-itemId-"+t),e.innerHTML='<hr style="margin-top:0px;margin-bottom:1px;">',o.append(e)}else i("not found right column for item - "+t)},Ye=e=>{if(!e.receivedResponse)return;if(!Ze())return;const t=document.querySelector(`.pvv-ext-itemId-${e.id}`);if(!t)return;e.productInformationAdded=!0,t.dataset.quantity=e.quantity;const n='style="color: #000050;"';if(b.ebay_show_QuantityAvailable&&!t.querySelector(".pvv-ext-quantity")){const r=document.createElement("div");r.classList.add("pvv-ext-quantity"),r.innerHTML="<span "+n+">Quantity: </span>"+e.quantityAvailableTxt,t.append(r)}if(b.ebay_show_QuantityItemsSold&&!t.querySelector(".pvv-ext-quantitySold")){const r=document.createElement("div");r.classList.add("pvv-ext-quantitySold"),r.innerHTML="<span "+n+">Sold: </span>"+e.quantitySoldTxt.replace(" sold",""),t.append(r)}if(b.ebay_show_Delivery&&!t.querySelector(".pvv-ext-delivery")){const r=document.createElement("div");r.classList.add("pvv-ext-delivery"),r.innerHTML="<span "+n+">Delivery: </span>"+e.deliveryTxt,t.append(r)}if(b.ebay_show_Returns&&!t.querySelector(".pvv-ext-returns")){const r=document.createElement("div");r.classList.add("pvv-ext-returns"),r.innerHTML="<span "+n+">Return: </span>"+e.returnsTxt,t.append(r)}if(b.ebay_show_Brand&&!t.querySelector(".pvv-ext-brand")){const r=document.createElement("div");r.classList.add("pvv-ext-brand"),r.innerHTML="<span "+n+">Brand: </span>"+e.brand,t.append(r)}if(b.ebay_show_ItemSpecifics&&!t.querySelector(".pvv-ext-itemSpecifics")){const r=document.createElement("div");r.classList.add("pvv-ext-itemSpecifics"),e.itemSpecifics?.mpn&&(r.innerHTML+="<div><span "+n+">MPN: </span>"+e.itemSpecifics.mpn+"</div>"),e.itemSpecifics?.upc&&(r.innerHTML+="<div><span "+n+">UPC: </span>"+e.itemSpecifics.upc+"</div>"),e.itemSpecifics?.ean&&(r.innerHTML+="<div><span "+n+">EAN: </span>"+e.itemSpecifics.ean+"</div>"),t.append(r)}},Je=async(e,t)=>{const n=await S(e.id,"ProductInformation");if(n)return m(n,e),void z(e.element,e);e.sentRequest||("high"===t?Fe.add(e):Fe.addToAdditionalQueue(e))},et=e=>{const t=(e=>{let t,n,r,o="",a=!1;return o=(e.querySelector(".s-item__title")||e.querySelector(".lvtitle a"))?.innerText.trim(),r=Ge(e),n=Ke(r,e),(e.querySelector(".s-item__fnf")||e.querySelector(".s-item__freeXDays"))&&(a=!0),n&&r&&o||(t=`ebay getItemData - Can't get item data from ${e}`),{error:t,id:n,href:r,title:o,fastAndFree:a}})(e);if(!t.error&&!je(t.id)){const n=(({id:e,title:t,href:n,element:r,isDisplayed:o=!0,fastAndFree:a=!1})=>({id:e,title:t,href:n,sentRequest:!1,receivedResponse:!1,element:r,isDisplayed:o,fastAndFree:a,isVisible:!1,productInformationAdded:!1}))({...t,element:e});(e=>{We.push(e)})(n)}},tt=e=>{e.isDisplayed=!0,b.ebay_only_FastAndFree&&!e.fastAndFree&&(e.isDisplayed=!1),b.ebay_hide_ItemsByQuantity&&e.receivedResponse&&e.quantity<b.ebay_hide_ItemsByQuantity_minQuantity&&(e.isDisplayed=!1)},nt=e=>{if(e.element.hidden=!e.isDisplayed,e.isDisplayed){const t=e.element,n=t.querySelector(".s-item__price")||t.querySelector(".lvprice.prc"),r=t.querySelector(".s-item__logisticsCost")||t.querySelector(".lvshipping");at(t,n,r),it(t,e.title,n,!0),Xe(t,e.id),Ye(e)}},rt=e=>{const t=e.detail;t&&(tt(t),nt(t))},ot=()=>{const e=b.buyerAddress;let t=document.querySelector(".pvv-ext-BuyerAddressContainer");if(!b.mainSwitch)return void(t&&t.remove());if(t){if(!h.updateBuyerAddress)return;t&&t.remove(),h.updateBuyerAddress=!1}const n=document.querySelector(".module.shipping-address.auto-address-container");if(!n)return;t=document.createElement("div"),t.style="margin-bottom: 5px;",t.classList.add("pvv-ext-BuyerAddressContainer"),n.parentElement.insertBefore(t,n),l(!0),l(!1,!0),function(){const e=document.createElement("button");e.type="button",e.innerHTML=`<img src="${Ve}" style="height: 15px; position: absolute; left: 3;"/> <span style='margin-left: 18px;'> Set message to seller</span>`,e.style="padding: 5px; margin: 5px; position: relative",e.disabled=!b.ebay_MessageToSeller,t.appendChild(e),e.onclick=async function(){if(!b.active)return r.style="display: block;",void r.scrollIntoView({block:"center",behavior:"smooth"});const e=document.querySelector('a[data-test-id="MESSAGE_TO_SELLER_OPEN"]');if(e){const t=await D(e,I,'textarea[data-test-id="MESSAGE_TO_SELLER_TEXT_AREA"]');if(t){t.value=b.ebay_MessageToSeller,t.dispatchEvent(k);const e=document.querySelector('button[data-test-id="MESSAGE_TO_SELLER_SUBMIT"]');e&&e.dispatchEvent(I)}}}}();const r=O(b);t.append(r);const o=document.createElement("div");o.innerHTML='Address (<a id="load-address-from-clipboard" style="cursor: pointer">load from clipboard</a>):',t.appendChild(o);const a=document.querySelector("#load-address-from-clipboard");a&&a.addEventListener("click",(()=>{W(h,ot,d)}));const i=document.createElement("div");i.style="line-height: 1.3",e&&(e.innerHTML?i.innerHTML=b.buyerAddress.innerHTML:i.textContent=b.buyerAddress.text),t.appendChild(i);const d=document.createElement("div");function l(n,o=!1){const a=document.createElement("button");a.type="button",a.innerHTML=`<img src="${Ve}" style="height: 15px; position: absolute; left: 3;"/> <span style='margin-left: 18px;'> Add & Paste ${n?" & Save":""} address</span>`,a.style="padding: 5px; margin: 5px; position: relative",a.disabled=void 0===e,o&&a.classList.add("pvv-ext-AddressButton"),a.onclick=async function(){if(!b.active)return r.style="display: block;",void r.scrollIntoView({block:"center",behavior:"smooth"});const t='div.address-list--other-options div.render-summary--primary span a[data-test-id="GET_ADDRESS_FORM"]',o="#country";if(document.querySelector(o))a();else{const e=document.querySelector('[data-test-id="EXPAND_SHIPPING_ADDRESSES"]');if(e){if(!await D(e,I,t,100,5e3))return void s("TimeOut push btnChange")}const n=document.querySelector(t);if(n){if(!await D(n,I,o,100,5e3))return void s("push btnAddNewAddress TimeOut")}document.querySelector(o)&&a()}function a(){const t=document.querySelector(o),r=document.querySelector("#firstName"),a=document.querySelector("#lastName"),i=document.querySelector("#addressLine1"),s=document.querySelector("#addressLine2"),d=document.querySelector("#city"),l=document.querySelector("#stateOrProvince"),c=document.querySelector("#postalCode"),u=document.querySelector("#phoneNumber"),m=document.querySelector(".custom-phone-field__dial-code")||document.querySelector("#phone-country-number");function p(e,t){e.value=t,e.dispatchEvent(M),e.dispatchEvent(k)}async function y(){p(r,e.firstName),p(a,e.lastName),p(i,e.address1),p(s,e.address2),p(d,e.city),p(l,e.state),p(c,e.zip);let t=b.phone||e.phone;if(t&&t.includes("+")&&m){t="+"+t.trim().replace(/\D/g,"");const e=m?.textContent?.trim();if(t.includes(e))t=t.replace(e,"").trim();else{const e=[],n=".listbox-button__options";let r=document.querySelector(n);r?o(e,r):(r=await D(document.querySelector("#phoneCountryCode"),I,n,50,1e3),r&&o(e,r));const a=e.find((e=>t.includes(e.dialCode)));a&&(t=t.replace(a.dialCode,"").trim(),document.querySelector("#"+a.id)?.dispatchEvent(I))}}if(p(u,t),n){const e=document.querySelector(".address-list .btn--primary");e&&setTimeout((()=>{e.dispatchEvent(I)}),300)}function o(e,t){t.querySelectorAll(".listbox-button__option").forEach((t=>{e.push({id:t.id,countryName:t?.querySelector(".custom-phone-field__country-name")?.textContent?.trim(),dialCode:t?.querySelector(".custom-phone-field__dial-code")?.textContent?.trim()})}))}}"US"!==e.country||e.country!==t.value?(p(t,e.country),setTimeout(y,1500)):y()}},t.appendChild(a)}d.classList.add("pvv-ext-msg-wrapper"),t.appendChild(d)};function at(n,r,o){const a="pvv-ext-Margin",i=n.querySelector("."+a);if(i&&i.remove(),!b.mainSwitch||!b.showMargin)return;const s=r.textContent,d=t(s).minValue;if(!d)return;let l=0;if(o){const n=e(o.textContent);if(o.textContent.includes(n)){const e=t(o.textContent).minValue;l=e||0}}const c=d+l,u=1/(1-b.amazonFee/100),m=(c*u).toFixed(2),p=((c+.3*c)*u).toFixed(2),y=((c+.5*c)*u).toFixed(2),f=((c+1*c)*u).toFixed(2),h=e(s),v="font-size:14px;color:#909090;",g=document.createElement("div");g.style="font-size: 4px; margin-top: 2px; margin-bottom: 8px; line-height: 20px;",g.className=a,g.innerHTML=`\n        <div style="${v}"> ${h} ${m} - 0%</div>   \n        <div style="${v}"> ${h} ${p} - 30%</div>\n        <div style="${v}"> ${h} ${y} - 50%</div>\n        <div style="${v}"> ${h} ${f} - 100%</div>`,r.after(g)}function it(e,t,n,r=!1){const o="pvv-ext-divButtonSearchOnAmazon",i=e.querySelector("."+o);if(i&&i.remove(),!t||!b.mainSwitch||!b.buttonSearchOnAmazon)return;const s=a(t),d="https://www.amazon."+h.domain+"/s/?field-keywords="+s,l=document.createElement("div");l.style="margin: 2px;",l.className=o,l.innerHTML='<a href="'+d+'" target="_blank"><input type="image" img src='+Ue+' style="height:20px;" class="buttonSearchOnAmazon" value="Search on Amazon" /></a>',r?n.parentElement.insertBefore(l,n):n.append(l)}const st=e=>{let t=e.querySelector('[data-testid="x-price-primary"]');return t||(t=e.querySelector(".mainPrice")?.parentElement),t},dt={addProductInformationWrapper:Xe,addProductInformation:Ye,itemDisplayControl:tt,addBtnPasteAddress:ot,addMargin:at,addButtonSearchOnAmazon:it,addBtnSearchDefaultFilters:()=>{const e="pvv-ext-divButtonDefaultFilters",t=document.querySelector("."+e);if(t&&t.remove(),!b.mainSwitch||!b.ebay_button_DefaultFilters)return;const n="com"===h.domain||"ca"===h.domain;let r,o=!1;const a=function(e){for(let t of e){const e=document.querySelector(`[aria-label=${t}]`);if(e)return e}return}(["New","Nuevo","Neu","Neuf","Nowy","Nieuw","Nuovo"]);a&&(o=a.checked,o||(r=a?.closest("li")?.querySelector("a")?.href));const i=new URL(document.URL),s=i.searchParams.get("LH_BIN"),d=i.searchParams.get("LH_RPA"),l=i.searchParams.get("LH_PrefLoc"),c=function(){if("ca"===h.domain)return"1";return"3"}();if("1"!==s||"1"!==d||n&&l!==c||!o){const t=!o&&r?r:document.URL,a=new URL(t);a.searchParams.delete("LH_Auction"),a.searchParams.set("LH_BIN","1"),a.searchParams.set("LH_RPA","1"),n&&a.searchParams.set("LH_PrefLoc",c),function(t,n){const r=document.createElement("div");r.style="margin-bottom: 15px;",r.className=e;const o=n?"Location / ":" ";r.innerHTML="<a href="+t+"><button>New / Buy It Now / "+o+"Returns accepted</button></a>";let a=document.querySelector(".x-refine__body");if(a)return void a?.parentElement?.insertBefore(r,a);a=document.querySelector("#LeftNavCategoryContainer"),a||(a=document.querySelector("#LeftNavContainer"),a||(a=document.querySelector("#w1-w0"),a||(a=document.querySelector("#leftnav"))));a&&a.parentElement.insertBefore(r,a)}(a.toString(),n)}}},lt=chrome.runtime.getURL("img/icon-48.png"),ct=chrome.runtime.getURL("img/amazon.png"),ut=chrome.runtime.getURL("img/ebay.png"),mt=()=>{const e={addressSelect:!1,addressSelectVersion:"",search:!1,product:!1},t=document.location.href;return t.includes("walmart.com")?document.querySelector("form.delivery-identity.accordion-form")?(e.addressSelect=!0,e.addressSelectVersion="v1.5",e):document.querySelector("#add-edit-address-form")?(e.addressSelect=!0,e.addressSelectVersion="v1.6.6",e):t.includes("walmart.com/ip")?(e.product=!0,e):t.includes("walmart.com/search")||document.querySelector("[data-item-id]>[link-identifier]")?(e.search=!0,e):e:e};let pt=mt();const yt=()=>{const e=b.buyerAddress;let t=document.querySelector(".pvv-ext-BuyerAddressContainer");if(!b.mainSwitch||!e)return void(t&&t.remove());if(t){if(!h.updateBuyerAddress)return;t&&t.remove(),h.updateBuyerAddress=!1}const n="v1.5"===pt.addressSelectVersion?document.querySelector("form.delivery-identity.accordion-form"):document.querySelector("#add-edit-address-form");if(!n)return;t=document.createElement("div"),t.style="margin-top: 5px; margin-bottom: 10px;",t.classList.add("pvv-ext-BuyerAddressContainer"),n.parentElement.insertBefore(t,n),function(n){const o=document.createElement("button");o.type="button",o.innerHTML=`<img src="${lt}" style="height: 18px;"/> <span> Paste address </span>`,o.style="margin-top: 10px; margin-bottom: 5px;",o.disabled=void 0===e,o.onclick=function(){if(!b.active)return r.style="display: block;",void r.scrollIntoView({block:"center",behavior:"smooth"});!function(){const t="v1.5"===pt.addressSelectVersion?document.querySelector("#firstName"):document.querySelector('[name="firstName"]'),n="v1.5"===pt.addressSelectVersion?document.querySelector("#lastName"):document.querySelector('[name="lastName"]'),r="v1.5"===pt.addressSelectVersion?document.querySelector("#addressLineOne"):document.querySelector('[name="addressLineOne"]'),o="v1.5"===pt.addressSelectVersion?document.querySelector("#addressLineTwo"):document.querySelector('[name="addressLineTwo"]'),a="v1.5"===pt.addressSelectVersion?document.querySelector("#city"):document.querySelector('[name="city"]'),i="v1.5"===pt.addressSelectVersion?document.querySelector("#state"):document.querySelector('[name="state"]'),s="v1.5"===pt.addressSelectVersion?document.querySelector("#postalCode"):document.querySelector('[name="postalCode"]'),d="v1.5"===pt.addressSelectVersion?document.querySelector("#phone"):document.querySelector('[name="phone"]');function l(e,t){null!=t&&0!=t.length&&(e.value=t,e.dispatchEvent(k))}!function(){l(t,e.firstName),l(n,e.lastName),l(r,e.address1),l(o,e.address2),l(a,e.city),l(i,e.state),l(s,e.zip);let c=b.phone?b.phone:e.phone;l(d,c),d.value=c}()}()},o.classList.add("pvv-ext-AddressButton"),t.appendChild(o)}();const r=O(b);t.append(r);const o=document.createElement("div");o.innerHTML='Address (<a id="load-address-from-clipboard" style="cursor: pointer; color: blue">load from clipboard</a>):',t.appendChild(o);const a=document.querySelector("#load-address-from-clipboard");a&&a.addEventListener("click",(()=>{W(h,yt,s)}));const i=document.createElement("div");i.style="line-height: 1.3",e&&(e.innerHTML?i.innerHTML=b.buyerAddress.innerHTML:i.textContent=b.buyerAddress.text),t.appendChild(i);const s=document.createElement("div");s.classList.add("pvv-ext-msg-wrapper"),t.appendChild(s)},ft=()=>{const e=document.createElement("div");return e.className="pvv-ext-mainDiv",e.innerHTML='<hr style="margin-top:0px; margin-bottom:0px; border: 0px solid #f1f1f2; border-bottom-width: 1px;">\n                         <div class="pvv-ext-wrap-buttons">\n                            <div class="pvv-ext-wrap-buttons-amz" style="display: inline-block;"></div>\n                            <div class="pvv-ext-wrap-buttons-ebay" style="display: inline-block;"></div>\n                        </div>',e},ht={addBtnPasteAddress:yt,addSearchButtons:()=>{if(pt.search){document.querySelectorAll("[data-item-id]>[link-identifier]").forEach((n=>{const r=n?.parentNode;if(!r)return;const o=r.querySelector('[data-automation-id="product-title"]');if(!o)return;let a=r?.parentNode?.querySelector(".pvv-ext-mainDiv");a||(a=ft(),N(a,r));const i=o?.textContent?.trim();e(a,i),t(a,i)}))}else if(pt.product){const n=document.querySelector('div>section>[itemprop="name"]');if(!n)return;let r=document.querySelector(".pvv-ext-mainDiv");r||(r=ft(),N(r,n));const o=n?.textContent?.trim();e(r,o),t(r,o)}function e(e,t){const n="pvv-ext-divButtonSearchOnAmazon";let r=e.querySelector("."+n);if(!b.mainSwitch||!b.walmartAddButtonSearchOnAmazon)return void(r&&r.remove());if(r)return;const o=a(t),i="https://www.amazon."+h.domain+"/s/?field-keywords="+o;r=document.createElement("div"),r.style="margin: 2px;",r.className=n,r.innerHTML='<a href="'+i+'" target="_blank"><input type="image" img src='+ct+' style="height: 20px; padding-top: 1px;" class="buttonSearchOnAmazon" value="Search on Amazon" /></a>',e.querySelector(".pvv-ext-wrap-buttons-amz").append(r)}function t(e,t){const n="pvv-ext-divButtonSearchOnEbay";let r=e.querySelector("."+n);if(!b.mainSwitch||!b.walmartAddButtonSearchOnEbay)return void(r&&r.remove());if(r)return;const o=a(t);let i="https://www.ebay."+h.domain+"/sch/i.html?&_nkw="+o;b.walmartAddButtonSearchOnEbay_BuyItNow&&(i+="&LH_BIN=1"),b.walmartAddButtonSearchOnEbay_ItemLocation_NorthAmerica?i+="&LH_PrefLoc=3":i+="&LH_PrefLoc=98",i+="&_sop=12",r=document.createElement("div"),r.style="margin: 2px;",r.className=n,r.innerHTML='<a href="'+i+'" target="_blank"><input type="image" img src='+ut+' style="height:17px;" value="Search on ebay" /></a>',e.querySelector(".pvv-ext-wrap-buttons-ebay").append(r)}}},vt=chrome.runtime.getURL("img/icon-48.png"),gt=()=>{const e={addressSelect:!1,addressSelectVersion:""};return document.location.href.includes("totalelement.com")?(document.querySelector("#checkout_shipping_address_address1")&&(e.addressSelect=!0,e.addressSelectVersion="v1.5.7"),(document.querySelector("#shippingAddressForm")||document.querySelector('[name = "lastName"]')&&document.querySelector('[name = "address1"]'))&&(e.addressSelect=!0,e.addressSelectVersion="v2.0.10"),e):e};let bt=gt();const St=()=>{const e=b.buyerAddress;let t=document.querySelector(".pvv-ext-BuyerAddressContainer");if(!b.mainSwitch)return void(t&&t.remove());if(t){if(!h.updateBuyerAddress)return;t&&t.remove(),h.updateBuyerAddress=!1}const n=document.querySelector('[name = "countryCode"]'),r=document.querySelector("#shippingAddressForm")||document.querySelector(".address-fields")||n?.parentElement;if(!r)return;t=document.createElement("div"),t.style="margin-top: 5px; margin-bottom: 10px; margin-left: 10px;",t.classList.add("pvv-ext-BuyerAddressContainer"),r?.parentElement?.insertBefore(t,r),function(){const n=document.createElement("button");n.type="button",n.innerHTML=`<img src="${vt}" style="height: 18px;"/> <span> Paste address </span>`,n.innerHTML=`<img src="${vt}" style="height: 18px; position: absolute; left: 3;"/> <span style='margin-left: 20px;'> Paste address</span>`,n.classList.add("pvv-ext-AddressButton"),n.style="padding: 5px; padding-right: 10px; margin: 5px; position: relative; border: 1px solid;",n.disabled=void 0===e,n.onclick=function(){if(!b.active)return o.style="display: block;",void o.scrollIntoView({block:"center",behavior:"smooth"});!function(){const t=document.querySelector('[name = "countryCode"]')||document.querySelector("#checkout_shipping_address_country"),n=document.querySelector('[name = "firstName"]')||document.querySelector("#checkout_shipping_address_first_name"),r=document.querySelector('[name = "lastName"]')||document.querySelector("#checkout_shipping_address_last_name"),o=document.querySelector('[name = "address1"]')||document.querySelector("#checkout_shipping_address_address1"),a=document.querySelector('[name = "address2"]')||document.querySelector("#checkout_shipping_address_address2"),i=document.querySelector('[name = "city"]')||document.querySelector("#checkout_shipping_address_city"),s=document.querySelector('[name = "postalCode"]')||document.querySelector("#checkout_shipping_address_zip"),d=document.querySelector('[name = "phone"]')||document.querySelector("#checkout_shipping_address_phone");function l(e,t){if("SELECT"===e.nodeName)for(let n=0;n<e.options.length;n++)if(e.options[n].value===t||e.options[n].dataset.code===t){e.options[n].selected=!0;break}e.value=t,e.dispatchEvent(M),e.dispatchEvent(k)}function c(){const t=document.querySelector('[name = "zone"]')||document.querySelector("#checkout_shipping_address_province");l(n,e.firstName),l(r,e.lastName),l(o,e.address1),l(a,e.address2),l(i,e.city),l(t,e.state),l(s,e.zip);const c=b.phone?b.phone:e.phone;l(d,c)}t.value===e.country?c():(l(t,e.country),setTimeout(c,500))}()},t.appendChild(n)}();const o=O(b);t.append(o);const a=document.createElement("div");a.innerHTML='Address (<a id="load-address-from-clipboard" style="cursor: pointer; color: blue">load from clipboard</a>):',t.appendChild(a);const i=document.querySelector("#load-address-from-clipboard");i&&i.addEventListener("click",(()=>{W(h,St,d)}));const s=document.createElement("div");s.style="line-height: 1.3",e&&(e.innerHTML?s.innerHTML=b.buyerAddress.innerHTML:s.textContent=b.buyerAddress.text),t.appendChild(s);const d=document.createElement("div");d.classList.add("pvv-ext-msg-wrapper"),t.appendChild(d)},xt={addBtnPasteAddress:St},wt=chrome.runtime.getURL("img/icon-48.png"),At=chrome.runtime.getURL("img/spinner.gif"),qt=()=>{const e={addressSelect:!1,search:!1,product:!1};return document.location.href.includes(".aliexpress.")&&document.querySelector(".comet-modal-body")&&document.querySelector(".sdk-country-flag")&&(document.querySelector('[placeholder*="ZIP Code"]')||document.querySelector('[placeholder*="Zip Code"]')||document.querySelector('[placeholder*="Zipcode"]')||document.querySelector('[placeholder*="ZIP code"]'))?(e.addressSelect=!0,e):e};let Ct=qt();const _t=()=>document.querySelector(".pvv-ext-BuyerAddressContainer"),Lt=()=>{const e=b.buyerAddress;let t=_t();if(!b.mainSwitch)return void(t&&t.remove());if(t){if(!h.updateBuyerAddress)return;t.remove(),h.updateBuyerAddress=!1}const n=document.querySelector(".comet-modal-body .deliver-address-wrap");if(!n)return;t=document.createElement("div"),t.setAttribute("style","margin-bottom: 5px; margin-left: 15px;"),t.classList.add("pvv-ext-BuyerAddressContainer"),n.parentElement.insertBefore(t,n),function(){const n=document.createElement("button");n.type="button",n.innerHTML=`<img src="${wt}" style="height: 18px;"/> <span> Paste address </span>`,n.disabled=void 0===e,n.onclick=async function(){if("US"!==e.country&&"CA"!==e.country)return V(d,"For USA and Canada only",15e3),void c("aliexpress",e,"country = "+e.country);if(!b.active)return r.setAttribute("style","display: block;"),void r.scrollIntoView({block:"center",behavior:"smooth"});n.disabled=!0;const t=200,o=1e3,a=E(e.country).getAliexpressStateValue(e.state),i=function(e,t){const n=A(e).trim().replace(/ /g,"").replace(/-/g,"").replace(/\(/g,"").replace(/\)/g,""),r={countryCode:"",phoneNumber:n};return"US"!==t&&"CA"!==t||(10===n.length?r.countryCode="+1":11===n.length&&"1"===n.slice(0,1)?(r.countryCode="+1",r.phoneNumber=n.slice(1)):12===n.length&&"+1"===n.slice(0,2)&&(r.countryCode="+1",r.phoneNumber=n.slice(2))),r}(b.phone?b.phone:e.phone,e.country);let l=e.zip.trim(),u=e.city.trim();"US"===e.country&&(l=l.replace(/ /g,"").replace(/-/g,""));let m=!0;!function(e){e.innerHTML=`<img src=${At} style="height: 60px;">`}(d);try{await y()}catch(e){}await H(500);let p=v();if(p.length>0){p.forEach((e=>s(e)));try{await y()}catch(e){s(e.message)}if(p=v(),p.length>0){const t=p.join("; ");V(d,t,15e3),c("aliexpress",e,t),m=!1}}async function y(){const n=document.querySelector(".sdk-country-flag");if(!n)throw new Error("Can't find countryFlag element.");await async function(){const r="US"===e.country?"country-us":"country-ca";if(!n.classList.contains(r)){const e=await D(n,I,`.next-overlay-wrapper.opened .option-item-flag.sdk-country-flag.${r}`,t,o);if(!e)throw new Error("Can't change country. [optionCountry]");if(!await D(e,I,`i.sdk-country-flag.${r}:not(.option-item-flag)`,t,o))throw new Error("Can't change country. [countryFlagNew]");await H(1e3)}}(),await H(500);const r=document.querySelector(".deliver-address-wrap"),s=f(e.country),d=r.querySelector(".deliver-address-wrap .text-button-container");if(d){if(!await D(d,I,s,t,o))throw new Error("Can't click 'Or enter address manually' button");await H(1e3)}const{firstName:c,lastName:m,fullName:p,phoneCode:y,phoneNumber:v,addressLine1:g,addressLine2:b,region:S,city:x,zip:w,regionParent:A,cityParent:q}=h(e.country);if("US"===e.country?(B(c,e.firstName),B(m,e.lastName)):B(p,e.fullName),B(y,i.countryCode),B(v,i.phoneNumber),B(g,e.address1),await H(500),r?.dispatchEvent(I),B(b,e.address2),B(w,l),await H(1e3),!await D(S,I,'.next-overlay-wrapper.opened ul[role="listbox"]',t,o))throw new Error("Can't change region. [regionListbox]");const C=await $(`.next-overlay-wrapper.opened [title="${a}"]`,t,o);if(!C)throw new Error("Can't change state. [stateOption]");C.dispatchEvent(I),await H(1e3);const _=A?.querySelector(`span em[title="${a}"]`);if(!_)throw new Error("Can't change state. [checkRegion]");if(!await D(x,I,'.next-overlay-wrapper.opened ul[role="listbox"]',t,o))throw new Error("Can't change city. [cityListbox]");const L=await $(`.next-overlay-wrapper.opened [title="${u}" i]`,t,o);if(!L)throw new Error("Can't change city. [cityOption]");L.dispatchEvent(I),await H(500);const E=q?.querySelector(`span em[title="${u}" i]`);if(!E)throw new Error("Can't change city. [checkCity]");function B(e,t){e.dispatchEvent(I),e.value=t,e.setAttribute("value",t);const n=Object.getOwnPropertyDescriptor(e.__proto__,"value")?.set;n&&n.call(e,t),e.dispatchEvent(k),e.dispatchEvent(M)}B(y,i.countryCode),B(v,i.phoneNumber),B(b,e.address2),B(w,l)}function f(e){return"US"===e||"CA"===e?'input[placeholder*="Street"]':void 0}function h(e){const t=f(e),n=document.querySelector('input[placeholder*="First name"]'),r=document.querySelector('input[placeholder*="Contact name"]'),o=document.querySelector('input[placeholder*="Last name"]'),a=document.querySelector('[role="gridcell"]:has(input[placeholder*="Mobile number"]) input'),i=document.querySelector('input[placeholder*="Mobile number"]'),s=document.querySelector(t),d=document.querySelector('input[placeholder*="Apt"]'),l=document.querySelectorAll('input[placeholder*="ZIP"]'),c=l[l.length-1];if("US"===e)return{firstName:n,lastName:o,phoneCode:a,phoneNumber:i,addressLine1:s,addressLine2:d,region:document.querySelectorAll('[role="gridcell"]')[7].querySelector("span"),city:document.querySelectorAll('[role="gridcell"]')[8].querySelector("span"),zip:c,regionParent:document.querySelectorAll('[role="gridcell"]')[7],cityParent:document.querySelectorAll('[role="gridcell"]')[8]};if("CA"===e){const e=document.querySelectorAll('[role="gridcell"]')[5],t=e.querySelector("span"),n=document.querySelectorAll('[role="gridcell"]')[6];return{fullName:r,phoneCode:a,phoneNumber:i,addressLine1:s,addressLine2:d,region:t,city:n.querySelector("span"),zip:c,regionParent:e,cityParent:n}}}function v(){const t=[],{firstName:n,lastName:r,fullName:o,phoneCode:s,phoneNumber:d,addressLine1:c,addressLine2:m,zip:p,regionParent:y,cityParent:f}=h(e.country);"US"===e.country?(b("FirstName",n,e.firstName,t),b("LastName",r,e.lastName,t)):b("FullName",o,e.fullName,t),b("PhoneCode",s,i.countryCode,t),b("PhoneNumber",d,i.phoneNumber,t),b("AddressLine1",c,e.address1,t),b("AddressLine2",m,e.address2,t);const v=y?.querySelector(`span em[title="${a}"]`);v||t.push("Can't change [State]");const g=f?.querySelector(`span em[title="${u}" i]`);return g||t.push("Can't change [City]"),b("Zip",p,l,t),t;function b(e,t,n,r){(function(e,t){return e?.value?e?.value?.trim().toLowerCase()!==t.trim().toLowerCase():""!==t.trim()})(t,n)&&r.push(`Can't change [${e}]`)}}!function(e){e.innerHTML=""}(d),m?Q(d,"Address insertion was successful",5e3):V(d,"! ! ! Inserting address failed ! ! !",7e3),n.disabled=!1},n.classList.add("pvv-ext-AddressButton"),n.classList.add("comet-btn"),t?.appendChild(n)}();const r=O(b);t.append(r);const o=document.createElement("div");o.innerHTML='Address (<a id="load-address-from-clipboard" style="cursor: pointer; color: blue">load from clipboard</a>):',t.appendChild(o);const a=document.querySelector("#load-address-from-clipboard");a&&a.addEventListener("click",(()=>{W(h,Lt,d)}));const i=document.createElement("span");i.setAttribute("style","line-height: 1.3; display: table-cell;"),e&&(e.innerHTML?i.innerHTML=b.buyerAddress.innerHTML:i.textContent=b.buyerAddress.text),t.appendChild(i);const d=document.createElement("span");d.classList.add("pvv-ext-msg-wrapper"),d.setAttribute("style","padding-left: 30px; display: table-cell; vertical-align: top;"),t.appendChild(d)},Et={addBtnPasteAddress:Lt,clearBtnPasteAddress:()=>{const e=_t();e&&e.remove()}};i("Grabley extension connected!");let Bt,Pt=1e3;var Tt;document.addEventListener("keydown",(e=>{if(!e.altKey||"KeyX"!==e.code&&"KeyC"!==e.code||setTimeout((()=>{const e=document.querySelector(".pvv-ext-AddressButton");e&&!e.disabled&&e.dispatchEvent(new Event("click"))}),100),e.altKey&&"Digit1"===e.code&&g(b,"hidePrime")){const e=!b.hidePrime;chrome.storage.local.set({hidePrime:e}),"popup"!==Tt&&G(e,'Hide - "prime" items')}if(e.altKey&&"Digit2"===e.code&&g(b,"hideSoldByAmazon")){const e=!b.hideSoldByAmazon;chrome.storage.local.set({hideSoldByAmazon:e}),"popup"!==Tt&&G(e,"Hide - Sold by Amazon")}}));const Ot={getElemOrderIdValue:function(){return document.querySelector('span[data-test-id="order-id-value"]')},isOrderPage:function(){return!!Ot.getElemOrderIdValue()},addBtnCopyOrderID:function(){const e="pvv-ext-BtnCopyOrderID-Container";let t=document.querySelector("."+e);if(!b.mainSwitch)return void(t&&t.remove());if(t)return;const n=Ot.getElemOrderIdValue();if(null===n)return;t=document.createElement("span"),t.style="margin-left: 5px; margin-right: 5px;",t.classList.add(e),N(t,n);const r=document.createElement("a");r.title='Copy "Order ID" to clipboard (grabley)',r.textContent="(Copy)",r.onclick=function(){navigator.clipboard.writeText(n.textContent).then((()=>{r.textContent="(Copied success)",setTimeout((function(){r.textContent="(Copy)"}),1500)})).catch((e=>{r.textContent="(Error! Failed to copy ID)",r.style="color: red; font-weight: bold",setTimeout((function(){t.remove()}),3e3),console.log("ERROR! Failed to copy ID. "+e)}))},t.appendChild(r)},observeElements:[],unobserveAll:function(){Ot.observeElements.forEach((e=>kt.unobserve(e))),Ot.observeElements=[]},observe:function(e){Ot.observeElements.push(e),kt.observe(e)},parsing:{queue:[],queueAdditional:[],add:function(e){void 0===Ot.parsing.queue.find((t=>t.asin===e.asin))&&Ot.parsing.queue.push(e)},addToAdditionalQueue(e){void 0===Ot.parsing.queueAdditional.find((t=>t.asin===e.asin))&&Ot.parsing.queueAdditional.push(e)},removeAll:function(){Ot.parsing.queue=[],Ot.parsing.queueAdditional=[]},start:function(){setInterval(Ot.parsing.parse,300)},parse:function(){if(!b.mainSwitch)return;let e=Ot.parsing.queue.shift();void 0===e&&(e=Ot.parsing.queueAdditional.shift()),void 0!==e&&async function(e){if(!e.href)return;if(e.sendQueryAdditionalInformation)return;e.sendQueryAdditionalInformation=!0;const t=await S(e.asin,"AdditionalInformation");if(t)return void m(t,e,["minPrice","maxPrice"]);const n=new XMLHttpRequest;n.responseType="text",n.open("GET",e.href,!0),n.send(),n.addEventListener("load",(()=>{200===n.status?Y(e,n.response):(e.errorFetchAdditionalInformation=!0,console.log("cannot get add.information on asin: "+e.asin),chrome.runtime.sendMessage({command:"pvv-ext-sendLog-amz-fetch-error",informationType:"product-page",sourceUrl:document.location.href,requestUrl:e.href,asin:e.asin,statusCode:n.status}))}))}(e)}},paramOutOfStock:"rh=p_n_availability%3A2661601011",elementIdOutOfStock:"p_n_availability/2661601011",isURLIncludesOutOfStockParam:e=>e.includes(Ot.paramOutOfStock),addOutOfStockParamToURL:e=>e+"&"+Ot.paramOutOfStock};if(h.amazon){if(Ot.parsing.start(),document.addEventListener("click",De.removeFullBSR),h.itemList||h.amzSellercentral){function Dt(){Bt!==document.URL&&(Ot.mainItem=void 0,Bt=document.URL,Mt())}Bt=document.URL,setInterval(Dt,1e3)}let zt=0;function $t(){const e=document.querySelectorAll("#address-ui-widgets-enterAddressLine1").length;zt!==e&&(zt=e,ue=ce(),Mt(),Nt())}setInterval($t,1500),!b.active&&h.amazon&&ue.product&&chrome.runtime.sendMessage({command:"pvv-ext-amz-increaseCountShowedQuantityOnProductPage"})}if(h.grabley){document.querySelector("#authorized")&&chrome.runtime.sendMessage({command:"pvv-ext-authorization",context:"content_script",addition:"User Profile"});document.querySelector("#no-offers")&&chrome.runtime.sendMessage({command:"pvv-ext-sendPing"})}if(h.ebay&&Qe.product){const Ht=st(document);if(Ht){let Ft=t(Ht.textContent).minValue;new MutationObserver((e=>{const n=t(Ht.textContent).minValue;n!==Ft?(Ft=n,Mt(!1)):Mt(!1,{ebay:{withoutReRendering:!0}})})).observe(Ht.parentNode,{attributes:!1,childList:!0,subtree:!0,characterData:!0})}}function Nt(){b.active&&b.useCrossBrowserAddressCopying&&(Qe.checkout||ue.addressSelect||pt.addressSelect||bt.addressSelect)&&chrome.runtime.sendMessage({command:"pvv-ext-updateBuyerAddressFromGrabley"})}const It=(e=!1)=>{e&&h.amazon&&(le=b.active||b.amz_showQuantityOnProductPage),Mt(e,{optionsChanged:!0})};chrome.storage.local.get(null,(function(e){for(let t in e){const n=e[t];g(b,t)&&(b[t]=n),"buyerAddress"===t&&(h.updateBuyerAddress=!0)}h.amazon||Nt(),It(!0)})),chrome.storage.onChanged.addListener((function(e,t){b.prev={...b};let n=!1;for(const t in e){const r=e[t].newValue;b[t]=r,"active"!==t&&"useCrossBrowserAddressCopying"!==t||(n=!0),"buyerAddress"===t&&(h.updateBuyerAddress=!0)}n&&Nt(),It()}));const kt=new IntersectionObserver((function(e,t){h.amazon&&Ot.parsing.removeAll(),e.forEach((e=>{if(h.amazon){const t=Se(e.target),n=ye(t.asin);if(void 0===n)return void console.log("error: ",e.target);b.mainSwitch&&(b.getBSR||b.showBuyBox||b.hideItemsWithVariation||b.showBrand||b.showProductInformation)&&n.isDisplayed&&!n.sendQueryAdditionalInformation&&(e.isIntersecting?Ot.parsing.add(n):Ot.parsing.addToAdditionalQueue(n))}if(h.ebay){const t=Ge(e.target),n=Ke(t,e.target);if(n){const t=je(n);t&&Ze()&&(t.isVisible=e.isIntersecting)}}})),h.ebay&&(()=>{if(Fe.removeAll(),!Ze())return;const e=We.findIndex((e=>e.isVisible));if(-1===e)We.filter((e=>e.isDisplayed&&!e.productInformationAdded)).forEach((e=>{Je(e,e.isVisible?"high":"low")}));else{const t=We.filter((e=>e.isDisplayed&&e.isVisible&&!e.sentRequest&&!e.productInformationAdded)),n=[],r=We.slice(0,e).filter((e=>e.isDisplayed&&!e.isVisible&&!e.sentRequest&&!e.productInformationAdded)),o=We.slice(e+1).filter((e=>e.isDisplayed&&!e.isVisible&&!e.sentRequest&&!e.productInformationAdded));r.reverse();const a=Math.max(r.length,o.length);for(let e=0;e<a;e++){const t=o[e],a=r[e];t&&n.push(t),a&&n.push(a)}t.forEach((e=>Je(e,"high"))),n.forEach((e=>Je(e,"low")))}Fe.start()})()}),{root:null,rootMargin:"0px",threshold:.1});function Mt(e,t){if(h.amazon){if(ue.search||ue.bestsellers||ue.deals){if(t?.optionsChanged&&document.querySelectorAll(".pvv-ext-divButtonSearchOnEbay").forEach((e=>e.remove())),ue.search){const t=De.getCheckboxIncludeOutOfStock();if(t?.parentElement?.addEventListener("click",De.turnOffOnlyCurrentlyUnavailableClickCallback),b.mainSwitch&&b.onlyCurrentlyUnavailable&&t&&!t.checked)return t.dispatchEvent(I),void(e&&setTimeout((()=>Mt(e)),3e3));Rt('[data-asin]:not([data-asin=""])'),De.hideAdvertisingBlocks()}if(ue.bestsellers&&(De.hideAdvertisingBlocks(),Rt("#gridItemRoot"),b.mainSwitch)){const e=document.querySelectorAll("#gridItemRoot"),t="570px";e.forEach((e=>{e.style.height!==t&&(e.style.height=t)}))}ue.deals,b.mainSwitch&&b.showPrime&&fe().forEach((e=>{_e(e)})),e&&setTimeout((function(){Mt(e)}),Pt)}if(h.itemList){let e=document.querySelector(".pvv-ext-mainDiv");if(e&&e.remove(),!b.mainSwitch)return;e=De.createMainDiv();let t=document.querySelector("#titleSection").parentElement;if(!t)return;N(e,t);const n=document.querySelector("#productTitle")?.textContent.trim(),r=window.location.href;let o=document.querySelector("#ASIN")?.value;if(o||(o=ve(r)),!n&&!o)return;const a=be();if(!ye(o)){const e=he({asin:o,title:n,href:r,qid:a,getOfferListingInformation:!0});pe(e)}const i=ye(o);i&&(Y(i,document),_e(i,Mt),De.addSearchButtons(e,i.title),De.addASIN(e,i),De.addBSR(e,i),De.addPrime(e,i),De.addTotalOffersAvailableQuantity(e,i,le),De.addProductDetailsLink(e,i),De.addPriceData(e,i),De.addBrand(e,i),De.addProductInformation(e,i),setTimeout(De.addOffersAvailableQuantity,1500))}h.buyerAddress&&De.addBtnCopyBuyerAddress(),h.amzSellercentral&&((document.querySelector("#myo-order-details-buyer-address")||document.querySelector('div[data-test-id="shipping-section-buyer-address"]')||document.querySelector("#shipping-section-buyer-address"))&&(h.buyerAddress=!0),e&&setTimeout((function(){Mt(e)}),Pt)),ue.addressSelect&&De.addBtnPasteAddress(),Ot.isOrderPage()&&Ot.addBtnCopyOrderID()}if(h.ebay){if(Qe.product){let e=!0;if(t?.ebay?.withoutReRendering){document.querySelector(".pvv-ext-Margin")&&(e=!1)}if(e){const e=st(document);if(e){const t=document.querySelector(".ux-labels-values--shipping .ux-textspans--BOLD");dt.addMargin(document,e,t)}}let n=document.querySelector('[data-testid="x-item-title"]');n||(n=document.querySelector("#vi-lkhdr-itmTitl"));const r=n?.textContent;dt.addButtonSearchOnAmazon(document,r,n)}Qe.search&&(dt.addBtnSearchDefaultFilters(),(()=>{if(!b.mainSwitch)return void We.forEach((e=>{e.isDisplayed=!0}));document.querySelectorAll(".sresult").forEach((e=>{et(e),e.addEventListener("updateDataEvent",rt)})),document.querySelectorAll(".srp-results .s-item[id]").forEach((e=>{et(e),e.addEventListener("updateDataEvent",rt)}));const e=document.querySelectorAll("div .srp-items-carousel__items-container");document.querySelectorAll("#mainContent li.s-item").forEach((t=>{let n=!1;e.length>0&&e.forEach((e=>{e.contains(t)&&(n=!0)})),n||(et(t),t.addEventListener("updateDataEvent",rt))})),We.forEach((e=>{tt(e)}))})(),We.forEach((e=>{nt(e)})),Ze()&&[...We].filter((e=>e.isDisplayed)).forEach((e=>{kt.observe(e.element)})),Fe.start()),Qe.checkout&&(dt.addBtnPasteAddress(),e&&setTimeout((()=>Mt(e)),Pt))}if(h.walmart){if(pt=mt(),!b.mainSwitch)return void document.querySelectorAll(".pvv-ext-mainDiv").forEach((e=>e.remove()));t?.optionsChanged&&document.querySelectorAll(".pvv-ext-divButtonSearchOnEbay").forEach((e=>e.remove())),pt.search&&ht.addSearchButtons(),pt.product&&ht.addSearchButtons(),pt.addressSelect&&ht.addBtnPasteAddress(),e&&setTimeout((()=>Mt(e)),Pt)}h.totalelement&&(bt.addressSelect?xt.addBtnPasteAddress():(bt=gt(),bt.addressSelect&&Nt()),e&&setTimeout((function(){Mt(e)}),2e3)),h.aliexpress&&(Ct=qt(),Ct.addressSelect?Et.addBtnPasteAddress():Et.clearBtnPasteAddress(),e&&setTimeout((()=>Mt(e)),Pt))}function Rt(e){Ot.unobserveAll();let t=0;const n=document.querySelectorAll(e);if(0===n.length)return;fe().forEach((e=>e.isDisplayed=!1));const r=document.querySelector("#s-refinements");if(r){const e=De.addFiltersWrap(r);De.addCustomerReviewsFilter(e);const t=!document.querySelector("#low-price")&&!document.querySelector("#filter-p_36");De.addPriceFilter(e,t)}const o=De.getPageOptions();for(let e=0;e<n.length;e++){const r=n[e],{error:a,asin:i,href:d,title:l,qid:c,minPrice:u,maxPrice:m,customerRatings:p}=Se(r);if(a)continue;if(Ot.observe(r),!ye(i)){const e=he({asin:i,title:l,href:d,qid:c,prime:xe(r),currentlyUnavailable:Ae(r),element:r,minPrice:u,maxPrice:m,customerRatings:p});pe(e)}const y=ye(i);if(y){if(qe(y,b,o),Ce(y,r),!y.isDisplayed)continue;let e=r.querySelector(".pvv-ext-mainDiv");if(!b.mainSwitch){e&&e.remove();continue}if(!e){if(e=De.createMainDiv(),h.searchList){let t=!1,n=null;h.searchList&&(t||(n=r.querySelector("h2 > a"),null!==n&&(t=!0,n.parentElement.parentElement.appendChild(e))),t||(n=r.querySelector("div.a-section.a-spacing-none a.a-link-normal"),null!==n&&(t=!0,n.parentElement.parentElement.appendChild(e))),t||(n=r.querySelector("div.sg-row:nth-child(2)>div:nth-child(2)"),null!==n&&(t=!0,n.parentElement.insertBefore(e,n),e.style["padding-left"]="12px")),t||(n=r.querySelector(".s-access-detail-page"),null===n&&(n=r.querySelector("img.s-image"),null===n||(t=!0,n.parentNode.parentNode.parentNode.appendChild(e))))),t||(null===n?r.insertBefore(e,r.firstChild):n.parentNode.parentNode.appendChild(e))}if(ue.bestsellers){const t=r.querySelector("a.a-link-normal > span > div");if(t){N(e,t.parentElement.parentElement)}else{const t=r.querySelector(".p13n-sc-uncoverable-faceout")?.querySelector("span");if(!t){s("Can't to find title element for add extension information");continue}N(e,t)}}h.amzDeals&&r.querySelector("#dealTitle").parentElement.appendChild(e)}De.addSearchButtons(e,y.title),De.addASIN(e,y),De.addBSR(e,y),De.addBuyBox(e,y),De.addPrime(e,y);const n=b.active||t<15;if(De.addTotalOffersAvailableQuantity(e,y,n),t++,De.addBrand(e,y),De.addProductInformation(e,y),De.addPriceData(e,y),!ue.bestsellers){r.querySelector('.a-price[data-a-color="base"] .a-offscreen')||!y.minPrice&&!y.maxPrice||De.addPrice(e,y)}}}}})();