!function(e){e.plot.plugins.push({init:function(o){var t={first:{x:-1,y:-1},second:{x:-1,y:-1},show:!1,currentMode:"xy",active:!1},n=e.plot.uiConstants.SNAPPING_CONSTANT,i={},l=null;function s(e){t.active&&(h(e),o.getPlaceholder().trigger("plotselecting",[c()]))}function r(n){var s=o.getOptions();1===n.which&&null!==s.selection.mode&&(t.currentMode="xy",document.body.focus(),void 0!==document.onselectstart&&null==i.onselectstart&&(i.onselectstart=document.onselectstart,document.onselectstart=function(){return!1}),void 0!==document.ondrag&&null==i.ondrag&&(i.ondrag=document.ondrag,document.ondrag=function(){return!1}),f(t.first,n),t.active=!0,l=function(e){!function(e){l=null,void 0!==document.onselectstart&&(document.onselectstart=i.onselectstart),void 0!==document.ondrag&&(document.ondrag=i.ondrag),t.active=!1,h(e),m()?a():(o.getPlaceholder().trigger("plotunselected",[]),o.getPlaceholder().trigger("plotselecting",[null]))}(e)},e(document).one("mouseup",l))}function c(){if(!m())return null;if(!t.show)return null;var n={},i={x:t.first.x,y:t.first.y},l={x:t.second.x,y:t.second.y};return"x"===d(o)&&(i.y=0,l.y=o.height()),"y"===d(o)&&(i.x=0,l.x=o.width()),e.each(o.getAxes(),(function(e,o){if(o.used){var t=o.c2p(i[o.direction]),s=o.c2p(l[o.direction]);n[e]={from:Math.min(t,s),to:Math.max(t,s)}}})),n}function a(){var e=c();o.getPlaceholder().trigger("plotselected",[e]),e.xaxis&&e.yaxis&&o.getPlaceholder().trigger("selected",[{x1:e.xaxis.from,y1:e.yaxis.from,x2:e.xaxis.to,y2:e.yaxis.to}])}function u(e,o,t){return o<e?e:o>t?t:o}function d(e){var o=e.getOptions();return"smart"===o.selection.mode?t.currentMode:o.selection.mode}function f(e,i){var l=o.getPlaceholder().offset(),s=o.getPlotOffset();e.x=u(0,i.pageX-l.left-s.left,o.width()),e.y=u(0,i.pageY-l.top-s.top,o.height()),e!==t.first&&function(e){if(t.first){var o={x:e.x-t.first.x,y:e.y-t.first.y};Math.abs(o.x)<n?t.currentMode="y":Math.abs(o.y)<n?t.currentMode="x":t.currentMode="xy"}}(e),"y"===d(o)&&(e.x=e===t.first?0:o.width()),"x"===d(o)&&(e.y=e===t.first?0:o.height())}function h(e){null!=e.pageX&&(f(t.second,e),m()?(t.show=!0,o.triggerRedrawOverlay()):g(!0))}function g(e){t.show&&(t.show=!1,t.currentMode="",o.triggerRedrawOverlay(),e||o.getPlaceholder().trigger("plotunselected",[]))}function x(e,t){var n,i,l,s,r=o.getAxes();for(var c in r)if((n=r[c]).direction===t&&(e[s=t+n.n+"axis"]||1!==n.n||(s=t+"axis"),e[s])){i=e[s].from,l=e[s].to;break}if(e[s]||(n="x"===t?o.getXAxes()[0]:o.getYAxes()[0],i=e[t+"1"],l=e[t+"2"]),null!=i&&null!=l&&i>l){var a=i;i=l,l=a}return{from:i,to:l,axis:n}}function m(){var e=o.getOptions().selection.minSize;return Math.abs(t.second.x-t.first.x)>=e&&Math.abs(t.second.y-t.first.y)>=e}o.clearSelection=g,o.setSelection=function(e,n){var i;"y"===d(o)?(t.first.x=0,t.second.x=o.width()):(i=x(e,"x"),t.first.x=i.axis.p2c(i.from),t.second.x=i.axis.p2c(i.to)),"x"===d(o)?(t.first.y=0,t.second.y=o.height()):(i=x(e,"y"),t.first.y=i.axis.p2c(i.from),t.second.y=i.axis.p2c(i.to)),t.show=!0,o.triggerRedrawOverlay(),!n&&m()&&a()},o.getSelection=c,o.hooks.bindEvents.push((function(e,o){null!=e.getOptions().selection.mode&&(o.mousemove(s),o.mousedown(r))})),o.hooks.drawOverlay.push((function(o,n){if(t.show&&m()){var i=o.getPlotOffset(),l=o.getOptions();n.save(),n.translate(i.left,i.top);var s=e.color.parse(l.selection.color),r=l.selection.visualization,c=1;"fill"===r&&(c=.8),n.strokeStyle=s.scale("a",c).toString(),n.lineWidth=1,n.lineJoin=l.selection.shape,n.fillStyle=s.scale("a",.4).toString();var a=Math.min(t.first.x,t.second.x)+.5,u=a,f=Math.min(t.first.y,t.second.y)+.5,h=f,g=Math.abs(t.second.x-t.first.x)-1,x=Math.abs(t.second.y-t.first.y)-1;"x"===d(o)&&(x+=f,f=0),"y"===d(o)&&(g+=a,a=0),"fill"===r?(n.fillRect(a,f,g,x),n.strokeRect(a,f,g,x)):(n.fillRect(0,0,o.width(),o.height()),n.clearRect(a,f,g,x),function(e,o,t,n,i,l,s,r){var c=15,a=Math.max(0,Math.min(c,n/2-2,i/2-2));e.fillStyle="#ffffff","xy"===r&&(e.beginPath(),e.moveTo(o,t+a),e.lineTo(o-3,t+a),e.lineTo(o-3,t-3),e.lineTo(o+a,t-3),e.lineTo(o+a,t),e.lineTo(o,t),e.closePath(),e.moveTo(o,t+i-a),e.lineTo(o-3,t+i-a),e.lineTo(o-3,t+i+3),e.lineTo(o+a,t+i+3),e.lineTo(o+a,t+i),e.lineTo(o,t+i),e.closePath(),e.moveTo(o+n,t+a),e.lineTo(o+n+3,t+a),e.lineTo(o+n+3,t-3),e.lineTo(o+n-a,t-3),e.lineTo(o+n-a,t),e.lineTo(o+n,t),e.closePath(),e.moveTo(o+n,t+i-a),e.lineTo(o+n+3,t+i-a),e.lineTo(o+n+3,t+i+3),e.lineTo(o+n-a,t+i+3),e.lineTo(o+n-a,t+i),e.lineTo(o+n,t+i),e.closePath(),e.stroke(),e.fill()),o=l,t=s,"x"===r&&(e.beginPath(),e.moveTo(o,t+c),e.lineTo(o,t-c),e.lineTo(o-3,t-c),e.lineTo(o-3,t+c),e.closePath(),e.moveTo(o+n,t+c),e.lineTo(o+n,t-c),e.lineTo(o+n+3,t-c),e.lineTo(o+n+3,t+c),e.closePath(),e.stroke(),e.fill()),"y"===r&&(e.beginPath(),e.moveTo(o-c,t),e.lineTo(o+c,t),e.lineTo(o+c,t-3),e.lineTo(o-c,t-3),e.closePath(),e.moveTo(o-c,t+i),e.lineTo(o+c,t+i),e.lineTo(o+c,t+i+3),e.lineTo(o-c,t+i+3),e.closePath(),e.stroke(),e.fill())}(n,a,f,g,x,u,h,d(o))),n.restore()}})),o.hooks.shutdown.push((function(o,t){t.unbind("mousemove",s),t.unbind("mousedown",r),l&&e(document).unbind("mouseup",l)}))},options:{selection:{mode:null,visualization:"focus",color:"#888888",shape:"round",minSize:5}},name:"selection",version:"1.1"})}(jQuery);