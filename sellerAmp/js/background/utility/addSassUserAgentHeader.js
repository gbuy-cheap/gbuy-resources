"use strict";import{allResourceTypes,declarativeNetRequest,headerOperation,ruleActionType}from"../constants/declarativeNetRequestConstants.js";import{ruleNameIDs}from"../constants/ruleNameIDs.js";import{SAS_SASS_USER_AGENT_MASK}from"../constants/urlMasks.js";import{sentrySellerAmp}from"../../content/sentrySellerAmp/sentrySellerAmp.js";import{sassUserAgent}from"../constants/userAgent.js";const addSassUserAgentHeader=()=>{SAS_SASS_USER_AGENT_MASK.forEach(addHeaderToResponse)},addHeaderToResponse=e=>{chrome.webRequest.onSendHeaders.addListener(createHandler(),{urls:[e]},["requestHeaders"])},createHandler=()=>()=>{sentrySellerAmp.wrap(function(){addUserAgent()})},addUserAgent=()=>{var e=sassUserAgent.value;e&&(declarativeNetRequest.updateDynamicRules({removeRuleIds:[ruleNameIDs.setSassAddressUserAgent,ruleNameIDs.setSassAddToCartUserAgent]}),e=[{operation:headerOperation.SET,header:"User-Agent",value:e}],declarativeNetRequest.updateDynamicRules({addRules:[{id:ruleNameIDs.setSassAddressUserAgent,priority:1,action:{type:ruleActionType.MODIFY_HEADERS,requestHeaders:e},condition:{urlFilter:"https://www.amazon*/gp/delivery/ajax/address-change*ssas*=*sass*sasRequestId=*",resourceTypes:allResourceTypes}},{id:ruleNameIDs.setSassAddToCartUserAgent,priority:1,action:{type:ruleActionType.MODIFY_HEADERS,requestHeaders:e},condition:{urlFilter:"https://www.amazon*/gp/aw/c?*ssas*=*sass*sasRequestId=*",resourceTypes:allResourceTypes}}]}))};export{addSassUserAgentHeader};