var Prefix=function(){var n="",r=function(r){return n+"-"+r};return{init:function(r){n=r},_:r,get:r,id:function(n){return"#"+r(n)},cc:function(n){return"."+r(n)},data:function(r){return n+"_"+r.replace(/-/g,"_")}}}();
Prefix.init("scxt");
var Helpers=function(){var e=function(e,r){void 0===r&&(r=2);var n=Number(e),a=!1;n<0&&(a=!0,n=-n);var o=(e=n.toFixed(r)).split(".");o[0]=Number(o[0]).toLocaleString();var i=t(),c=o.join(i);return a&&(c="-"+c),c},t=function(){var e=".";try{var t=parseFloat(1.5).toLocaleString().substring(1,2);"."!==t&&","!==t||(e=t)}catch(e){}return e};return Object.defineProperty(Array.prototype,"chunk",{value:function(e){for(var t=[],r=0;r<this.length;r+=e)t.push(this.slice(r,r+e));return t}}),Object.defineProperty(Array.prototype,"merge",{value:function(){for(var e=0;e<arguments.length;e++)for(var t=arguments[e],r=0;r<t.length;r++)-1===this.indexOf(t[r])&&this.push(t[r]);return this}}),String.prototype.toUpperCaseFirstChar=function(){return this.substr(0,1).toUpperCase()+this.substr(1)},{cleanHTML:function(e,t){return e=(e=(e=e.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"")).replace(/<style[\s\S]*?\/style>/gi,"")).replace(/onload=".*?"/gi,""),t&&t.image||(e=e.replace(/<img[^>]*>/gi,"")),e=e.replace(/<form [\s\S]+?<\/form>/gi,"")},getURLParam:function(e,t){t||(t=document.location);for(var r=t.search.substring(1).split("&"),n=0;n<r.length;n++){var a=r[n].split("=");if(a[0]==e)return a[1]}},removeURLParam:function(e,t){var r=t.split("?")[0],n=[],a=-1!==t.indexOf("?")?t.split("?")[1]:"";if(""!==a){for(var o=(n=a.split("&")).length-1;o>=0;o-=1)n[o].split("=")[0]===e&&n.splice(o,1);r=r+"?"+n.join("&")}return r},getHost:function(e){var t=document.createElement("a");return t.href=e,t.host},getDomainName:function(e){var t=e.split(".").reverse();return t.length>=3&&t[1].match(/^(com|edu|gov|net|mil|org|nom|co|name|info|biz)$/i)?t[2]+"."+t[1]+"."+t[0]:t[1]+"."+t[0]},getDate:function(e,t){void 0===t&&(t=new Date),e||(e="YYYY-MM-DD hh:mm:ss");var r=t.getFullYear(),n="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ")[t.getMonth()],a=("0"+(t.getMonth()+1)).substr(-2),o=("0"+t.getDate()).substr(-2),i=("0"+t.getHours()).substr(-2),c=("0"+t.getMinutes()).substr(-2),u=("0"+t.getSeconds()).substr(-2),s=e;return s=(s=(s=(s=(s=(s=(s=(s=s.replace("YYYY",r)).replace(/YY/g,r.toString().substr(-2))).replace("MMMM",n)).replace("MM",a)).replace("DD",o)).replace("hh",i)).replace("mm",c)).replace("ss",u)},clipboardWrite:function(e){var t=document.createElement("textarea");document.body.appendChild(t),t.value=e,t.select(),document.execCommand("copy"),t.parentNode.removeChild(t)},saveToFile:function(e,t){var r=document.createElement("a");r.download=t,r.href=e,r.click()},arrayToCSV:function(e,t){var r=[];return e.map(function(e){var n='"'+(e=e.map(function(e){return void 0===e&&(e=""),e=(e=(e=e.toString()).replace(/\r?\n|\r/g," ")).replace(/"/g,'""')})).join('"'+t+'"')+'"';r.push(n)}),r.join("\n")},injectInlineJS:function(e,t){t||(t=[]),t=t.map(function(e){return'"'+e+'"'});var r=document.createElement("script");r.textContent="("+e+")("+t.join(",")+")",(document.head||document.documentElement).appendChild(r),r.parentNode.removeChild(r)},formatNumber:e,getDecimalSeparator:t,deepSearchFormatNumber:function(t,r){for(var n=t,a=0,o=(r=r.split(".")).length;a<o;a++){if(void 0===n[r[a]])return;a===o-1?n[r[a]+"_fmt"]=e(n[r[a]],2):n=n[r[a]]}},getNrString:function(e){if("number"!=typeof e)return e;if(0===e)return e+"";var t=parseInt(Math.floor(Math.log(e)/Math.log(1e3)));return Math.round(e/Math.pow(1e3,t),2)+["","K","M","G","T"][t]},percent:function(e){return e?(100*parseFloat(e)).toFixed(0):""},convertPriceToNumber:function(e){var r,n=e.replace(/[^\d,.]+/g,"");return"."===n.substr(-1)&&(n=n.substr(0,n.length-1)),n?("."===(r=(n=n.replace(/[.,]+$/,"")).substr(-3,1).match(/[.,]/)?n.substr(-3,1):n.substr(-2,1).match(/[.,]/)?n.substr(-2,1):t())&&(n=n.replace(/,/g,"")),","===r&&(n=(n=n.replace(/\./g,"")).replace(",",".")),parseFloat(n)):0}}}();
var AMZHelpers={isProductPage:function(){return!!document.querySelector("#heroImage, #title_feature_div, #booksTitle, #superleafProductAlert_feature_div, #mediaProductTitle_feature_div, #dp.book")},isOffersPage:function(){return document.location.pathname.match(/\/gp\/offer-listing/)},getASIN:function(){var e=document.location.href,t=RegExp("/([A-Z0-9]{10})(\\W|$)"),r=e.match(t);if(r){var a=r[1];return a.match(/^\d+$/)?a:a.match(/^\d+X$/)?a:a.match(/^B/i)?a:""}return""},getASINFromPage:function(){var e=document.querySelector("#ASIN");return e||(e=document.querySelector("[name=ASIN]")),e||(e=document.querySelector('[name="ASIN.0"')),e&&e.value?e.value:(e||(e=document.querySelector("#averageCustomerReviews[data-asin]")),e||(e=document.querySelector("[data-asin]")),e?e.dataset.asin:void 0)}};
var Widget=function(t){this.id=t.id||"",this.src=t.src,this.class=t.class,this.prefix=t.prefix||"",this.parent=t.parent||document.body,this.$root=null,this.$iframe=null,this.animate=t.animate||{},this.onReady=t.onReady,this.onEnabled=t.onEnabled,this.onDisabled=t.onDisabled,this.onClosed=t.onClosed,this.onHide=t.onHide,this.onShow=t.onShow,t.draggable&&(this.draggable=!0,this.$handle=null,this.handleHTML=t.handleHTML,this.$dragHint=null,this.onPositionChanged=t.onPositionChanged,this.showDragHint=t.showDragHint)};Widget.prototype.inject=function(t){var i=this;this.$root=$("<div/>").attr("id",this.id).appendTo($(this.parent)),this.$iframe=$("<iframe/>").attr("src",this.src).appendTo(this.$root),this.draggable&&(this.showDragHint&&(this.$dragHint=$("<div/>").addClass(this.id+"-drag-hint").text("Use your mouse to drag me around").append($("<div/>",{class:this.id+"-drag-hint-arrow"})).appendTo(this.$root),setTimeout(function(){i.$dragHint.fadeIn("slow")},2e3)),this.$handle=$("<div/>").addClass(this.id+"-handle").append(this.handleHTML).prependTo(this.$root),this.initDragEvents())},Widget.prototype.addClass=function(t){this.$root.addClass(t)},Widget.prototype.show=function(){var t=function(){if(this.animate.show){var t=this.animate.show;this.$root.css(t.from),this.$root.show(),this.$root.animate(t.to,t.duration)}else this.$root.show()};this.$root?t.call(this):(this.inject(),t.call(this)),this.onShow&&this.onShow()},Widget.prototype.setPosition=function(t){var i=this.$root.width(),o=this.$root.height(),e=$(window).width(),s=$(window).height(),n=t.left,h=t.top;n<0&&(n=0),h<0&&(h=0),n>e-i&&(n=e-i),h>s-o&&(h=s-o),this.$root.css({left:n,top:h})},Widget.prototype.enable=function(){this.post("enable"),this.onEnabled&&this.onEnabled()},Widget.prototype.disable=function(){this.post("disable"),this.onDisabled&&this.onDisabled()},Widget.prototype.hide=function(){this.$root&&this.$root.hide(),this.onHide&&this.onHide()},Widget.prototype.toggle=function(){this.$root&&(this.$root.is(":visible")?this.hide():this.show())},Widget.prototype.remove=function(){this.$root&&this.$root.remove()},Widget.prototype.resize=function(t){t.width&&this.$iframe.css({width:t.width}),t.height&&this.$iframe.css({height:t.height})},Widget.prototype.post=function(t,i){this.$iframe?this.$iframe[0].contentWindow.postMessage({cmd:this.prefix+t,data:i},"*"):console.error("Iframe not found")},Widget.prototype.onMessage=function(t,i){this.prefix&&("widget.ready"===(t=t.replace(this.prefix,""))?"function"==typeof this.onReady&&this.onReady():"widget.resize"===t?this.resize(i):"widget.expand"===t?this.$iframe.addClass(this.prefix+"expanded"):"widget.collapse"===t?this.$iframe.removeClass(this.prefix+"expanded"):"widget.close"===t?(this.hide(),this.onClosed&&this.onClosed()):"widget.enable"===t?this.enable():"widget.disable"===t&&this.disable())},Widget.prototype.initDragEvents=function(){if(this.draggable){var t=this,i={x:0,y:0},o={rootW:0,rootH:0,winW:0,winH:0},e=function(e){e.preventDefault();var s=e.clientX-i.x,n=e.clientY-i.y;s<0&&(s=0),n<0&&(n=0),s>o.winW-o.rootW&&(s=o.winW-o.rootW),n>o.winH-o.rootH&&(n=o.winH-o.rootH),t.$root.css({left:s,top:n}),t.onPositionChanged&&t.onPositionChanged({left:s,top:n})};this.$handle.mousedown(function(s){t.$root.addClass(t.id+"-drag"),t.$dragHint&&t.$dragHint.remove();var n=t.$root.position();o={rootW:t.$root.width(),rootH:t.$root.height(),winW:$(window).width(),winH:$(window).height()},i.x=s.clientX-n.left,i.y=s.clientY-n.top,$(window).on("mousemove",e)}),$(window).mouseup(function(i){t.$root.removeClass(t.id+"-drag"),$(window).off("mousemove",e)}),this.$handle.hover(function(){t.$root.addClass(t.id+"-hover")},function(){t.$root.removeClass(t.id+"-hover")})}};
var Page=function(){var e,t,r,n,a=null,o={},i="",d=!1,l={},s=function(){new MutationObserver(function(e){var t=!1;e.forEach(function(e){if("childList"===e.type){for(var r=e.addedNodes,n=0,a=r.length;n<a;n++){var i=r[n];i.nodeType===Node.ELEMENT_NODE&&((i.querySelector("#aod-close")||"aod-offer"===i.id)&&(t=!0))}if(t){var d=h();y(document,d,1),t=!1,o.loadAllOffers&&f()}}})}).observe(AODRootNode,{subtree:!0,childList:!0,characterData:!0})},c=function(){var e=$("body"),t=h(),r=Helpers.getHost(document.location.href),n=$("<a>",{class:"a-declarative"}).attr("data-show-all-offers-display",'{"daodiDesktopExp2Treatment":"C"}').attr("data-csa-c-func-deps","aui-da-show-all-offers-display").attr("data-action","show-all-offers-display").attr("href",`https://${r}/gp/offer-listing/${t}/ref=olp_f_new?ie=UTF8`);e.append(n),n[0].click(),n.remove()},f=function(){if(w())a("loading_done");else{$("#aod-end-of-results").is(":visible")&&a("loading_done");var e=$("body > #all-offers-display");e[0]&&(e.is(":visible")||(c(),m()));var t=$("#all-offers-display-scroller");if(t[0]){var r=$("#aod-show-more-offers");r.is(":visible")&&r[0].click(),t[0].scrollTop=t[0].scrollHeight}else console.log("No scroller. Investigate")}},u=function(){a("clear_results"),g.reset(),p()},p=function(){var e=h();if(e){i=e,d=!!$("#aod-background")[0];var t,r,n,o=$("body > #all-offers-display");o[0]?(o.is(":visible")||(c(),m()),AODRootNode=o[0],s(),setTimeout(function(){y(document,e,1)},5e3)):(t=document.querySelector("body"),r=function(e){m()},(n=new MutationObserver(function(e){e.forEach(function(e){if("childList"===e.type)for(var t=e.addedNodes,a=0,o=t.length;a<o;a++){var i=t[a];"all-offers-display"===i.id&&(AODRootNode=i,n.disconnect(),s(),r&&r(i))}})})).observe(t,{subtree:!1,childList:!0,characterData:!1}),c()),a("loading"),chrome.runtime.sendMessage({cmd:"cpa.sendEvent",data:["page","run"]})}else console.log("asin not found")},m=function(){var e=$("body > #all-offers-display");e.css("right","-9999px"),setTimeout(function(){e.css("right","-9999px")},500),setTimeout(function(){e.css("right","-9999px")},1e3),$("#aod-background").hide(),document.body.style.overflow="auto"},h=function(){var e=AMZHelpers.getASIN();if(AMZHelpers.isProductPage()){var t=AMZHelpers.getASINFromPage();t&&(e=t)}return e},g=(e=0,t=0,r=!1,{update:function(n,a){if(!(t>n)){t=n,a&&(e=a.count);var o=t+1;o>e&&(r=!0),o>5&&(r=!0)}},next:function(){return r?-1:t+1},isDone:function(){return r},reset:function(){e=0,t=0,r=!1},print:function(){console.log({total:e,current:t,done:r})}}),v=function(e){return[e.sellerId,e.name,e.condition.en,e.fba?"fba":"",e.price].join("_")},y=(n=0,async function(e,t,r){var o=Helpers.getHost(document.location.href),i=x(e),d=!i.length;(i=i.filter(function(e){return!l[v(e)]})).length&&a("loading"),d&&setTimeout(function(){a("loading_done"),a("status",1===r?'<p>No offers found</p><p>Are we showing no offers found and you think there should be offers?<br>If you are browsing from a different country than where the product you are researching is located, try going to the <a href="https://'+o+"/gp/offer-listing/"+t+'/?ie=UTF8&f_collectible=true&f_new=true&f_used=true&f_usedAcceptable=true&f_usedGood=true&f_usedLikeNew=true&f_usedVeryGood=true&sr=1-1" target="_top">offers</a> page to count stock from that page.</p>':"")},100),n+=i.length;for(var s=0,c=i.length;s<c;s++)l[v(i[s])]=!0;for(s=0,c=i.length;s<c;s++){var f=i[s],u={asin:t,host:o,offer:f,page:r},p=await b(u);--n<=0&&(a("loading_done"),a("pageCount.status",w(e)));var m=p.result,h="",g=!1;m.error||(m.data.offerId&&m.data.offerId===f.offerId?(h=m.data.qty,g=!!m.data.limit):m.data.merchantId&&(f.sellerId!==m.data.merchantId&&"amazon"!==f.name.toLowerCase()||(h=m.data.qty,g=!!m.data.limit))),L(u,h,g)}}),b=function(e){return new Promise(function(t){chrome.runtime.sendMessage({cmd:"offer.getQty",data:e},function(r){t({params:e,result:r})})})},w=(function(){var e=Promise.resolve(),t=0}(),function(e){var t=parseInt($("#aod-total-offer-count",e).val());return!t||Object.keys(l).length>=t+1}),x=function(e){var t=[];if(document.location.pathname.match(/\/gp\/offer-listing/)||!d)$(".olpOffer",e).map(function(e,r){var n=N(r);n.index=e,t.push(n)});else{var r=$("#aod-pinned-offer, #aod-offer-list .aod-information-block",e);r.length||(r=$(".aod-information-block",e)),r.map(function(e,r){var n=I(r);n.offerId&&(n.index=e,t.push(n))})}return t},I=function(e){var t={},r=$(e),n=r.find('[name="offeringID.1"]').val();if(!n){var a=r.find("[data-aod-atc-action]").attr("data-aod-atc-action");if(a)try{n=JSON.parse(a).oid}catch(e){console.log(e)}}t.offerId=n;var o=r.find("#aod-offer-soldBy [role=link]")[0];if(o&&-1!==o.href.indexOf("help/customer")&&(o=""),o)t.sellerId=(o.href.match(/seller=(\w+)/)||[])[1],t.name=$.trim(o.textContent);else{var i=r.find("#aod-offer-soldBy .a-col-right")[0];i&&-1!==$.trim(i.textContent).indexOf("Amazon")&&(t.name="Amazon")}t.sellerId||(t.sellerId="");var d=$.trim(r.find("#aod-offer-shipsFrom .a-col-right span").text()),l=$.trim(r.find("#aod-offer-shipsFrom .a-col-left span").text());if(d.match(/^amazon/i)?(t.fba=!0,-1!==document.location.host.indexOf("amazon.ae")&&"Delivered by"===l&&(t.fba=!1)):t.fba=!1,t.price=$.trim(r.find(".a-price .a-offscreen").text()),!t.price){var s=$.trim(r.find("#aod-offer-price .a-col-left div:nth-child(2)").text());s&&s.match(/(TTC|IVA inclusa|incl\.)/)&&(t.price=s)}t.price=Helpers.convertPriceToNumber(t.price),t.shipPrice=0,t.condition=$.trim(r.find("#aod-offer-heading h5").text()).replace(/\s+/," "),t.condition=D(t.condition);var c=$.trim(r.find("#aod-offer-seller-rating").text()),f=-1;(u=c.match(/\(([\d.,]+) \w*\)/))?f=parseInt(u[1]):c.match(/\(one rating/)&&(f=1),f&&(t.ratingVal=f);var u,p=c.match(/(\d+)\s?%/);p&&(t.rating=parseInt(p[1])),t.rating>100&&(t.rating=t.rating.toString().replace(/^\d/,"")),(u=c.match(/(\d+) lifetime rating count/))&&(t.ratingVal=parseInt(u[1]));var m=E(r);m>=0&&(t.shipPrice=m);var h=r.find("#upsell-message b"),g=r.find("#delivery-message b, #dynamicDeliveryMessage b"),v=r.find("#mir-layout-DELIVERY_BLOCK-slot-DELIVERY_MESSAGE");v[0]||(v=r.find("#mir-layout-DELIVERY_BLOCK-slot-PRIMARY_DELIVERY_MESSAGE_LARGE"));var y="";return v[0]&&((y=$.trim(v.find("b").text()))||(y=$.trim(v.find(".a-text-bold").text()))),h[0]&&!y&&(y=$.trim(h[0].textContent)),g[0]&&!y&&(y=$.trim(g[0].textContent)),y&&(t.delivery=_(y)),t},E=function(e){var t=e.find("#ddmDeliveryMessage, #delivery-message").contents();if(t.length)return T(t);var r=e.find("#mir-layout-DELIVERY_BLOCK");if(r[0]){var n=r.find("[data-csa-c-delivery-price]").attr("data-csa-c-delivery-price");if(void 0===n)return t=r.find("#mir-layout-DELIVERY_BLOCK-slot-DELIVERY_MESSAGE").contents(),T(t);if(n||(n=""),n.match(/(gratis|free)/i))return 0;if(!n.match(/\d[.,]\d\d/))return;return Helpers.convertPriceToNumber(n)}},T=function(e){if(e.length){var t,r=e[0];if(r.nodeType===Node.TEXT_NODE&&((t=$.trim(r.textContent))||(r=e[1])),r&&(r.nodeType===Node.TEXT_NODE||"A"===r.tagName)){if((t=$.trim(r.textContent)).match(/(gratis|free)/i))return 0;if(!t.match(/\d[.,]\d\d/))return;return Helpers.convertPriceToNumber(t)}}},_=function(e){var t,r="";try{var n=Date.now();e.match(/today/i)?e=n:e.match(/tomorrow/i)?e=Date.now()+864e5:(e=(e=(e=(e=(e=e.replace(/(\w+ \d+) - \w+ \d+/,"$1")).replace(/(\d+ \w+) - \d+ \w+/,"$1")).replace(/(\d+) - \d+ (\w+)/,"$1 $2")).replace(/(\d+)\. - \d+\. (\w+)/,"$1 $2")).replace(/ - \d.*/,""),e+=" "+(new Date).getFullYear()),t=new Date(e),isNaN(t)||(r=t.getTime())}catch(e){console.log(e)}return r},N=function(e){var t=$(e),r={},n=t.find('[name="offeringID.1"]').val();n||(n=t.find('[name="oid"]').val()),r.offerId=n;var a=t.find(".olpSellerName a")[0],o=t.find(".olpSellerName img")[0];a&&(r.sellerId=(a.href.match(/seller=(\w+)/)||[])[1]),r.sellerId||(r.sellerId=""),r.name=$.trim(t.find(".olpSellerName").text()),!r.name&&o&&o.alt&&0===o.alt.toLowerCase().indexOf("amazon")&&(r.name="amazon"),r.price=$.trim(t.find(".olpOfferPrice").text()),r.price||(r.price=$.trim(t.find(".olpOfferVatInclPrice").text())),r.price=Helpers.convertPriceToNumber(r.price),r.shipPrice=$.trim(t.find(".olpShippingPrice").text()),r.shipPrice=Helpers.convertPriceToNumber(r.shipPrice),r.prime=!!t.find(".a-icon-prime")[0],$("#nav-business-name")[0]&&t.find(".olpBadge .olpFbaPopoverTrigger")[0]&&(r.prime=!0),r.fba=!!t.find(".olpFbaPopoverTrigger")[0],r.condition=$.trim(t.find(".olpCondition").text()).replace(/\s+/," "),r.condition=D(r.condition);var i=$.trim(t.find(".olpSellerColumn p b").text());if(i.match(/^\d+%/)||i.match(/^%\d+/)){r.rating=parseInt(i.replace("%",""));var d=A(t.find(".olpSellerColumn p").text());r.ratingVal=d}else r.rating=-1;return r},A=function(e){if(!e)return-1;for(var t,r=[/\(([\d,.]+) total ratings\)/i,/\(([\d,.]+) calificaciones totales\)/i,/\(([\d,.\s]+) évaluations totales\)/i,/\(([\d,.]+) valoraciones totales\)/i,/\(([\d,.]+) valoraciones en total\)/i,/\(([\d,.]+) valutazioni totali\)/i,/\(([\d,.]+) Bewertungen insgesamt\)/i,/\(Total de avaliações: ([\d,.]+)\)/i,/\(([\d,.]+) classificações no total\)/i,/\(Toplam ([\d,.]+) derecelendirme\)/i,/\([\d,.]+ évaluations\)/i,/\(共([\d,.]+)次评级\)/i,/\(([\d,.]+) 總評分\)/i,/\(([\d,.]+) 총 평가 점수\)/i,/\(([\d,.]+)件の評価\)/i,/\(([\d,.]+) कुल रेटिंग\)/i,/\(([\d,.]+) דירוגים\)/i],n=0,a=r.length;n<a;n++){var o=r[n],i=e.match(o);if(i){t=i[1];break}}return t=t?parseInt(t.replace(/\D/g,"")):-1},D=function(e){var t,r=e.toLowerCase(),n={new:"new",rental:"rental",collectible:"collectible","collectible - like new":"collectibleLikeNew",used:"used","used - like new":"usedLikeNew","used - very good":"usedVeryGood","used - good":"usedGood","used - acceptable":"usedAcceptable"},a={full:n[r]};return 0===r.indexOf("used")?a.short="used":0===r.indexOf("collectible")?a.short="collectible":a.short=r,n[r]?t=a.short:(t="new",r.indexOf("-")>-1&&(t="used")),a.en=t,a},O=function(e){var t=new URLSearchParams;return t.append("a",e.asin),t.append("oid",e.offer.offerId),t.append("o","add"),t.append("quantity","999"),t.append("verificationSessionID",e.sessionId),fetch("/gp/aw/c/",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:t}).then(function(t){return t.text().then(function(t){var r=S(t);return"number"==typeof r&&L(e,r),P()})})},S=function(e){var t;dom=(new DOMParser).parseFromString(e,"text/html");var r=Array.from(dom.querySelectorAll("input[name]")).filter(function(e){return e.getAttribute("name").startsWith("n:")});if(r&&r.length>0&&r[0].value){var n=r[0].value;t=parseInt(n)}else{divs=dom.querySelectorAll("div[data-asin]");var a=divs.length;if(a>0){for(var o=[],i=0;i<a;i++){var d,l=divs[i],s=parseInt(l.getAttribute("data-quantity")),c=l.getAttribute("data-encoded-offering"),f=/smid=([A-Z0-9]+)/.exec(l.innerHTML);f&&(d=f[1].replace(/"/g,"")),o.push({offerId:c,quantity:s,merchantId:d})}t=o}}return t},P=function(){return fetch("/gp/cart/view.html?ref_=nav_cart",{method:"GET",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){return e.text().then(function(e){var t=(new DOMParser).parseFromString(e,"text/html").getElementById("activeCartViewForm"),r=new URLSearchParams;return r.append(t.getElementsByClassName("sc-action-delete")[0].getElementsByTagName("input")[0].name,"1"),r.append("requestID",t.elements.requestID.value),r.append("token",t.elements.token.value),r.append("timeStamp",t.elements.timeStamp.value),r.append("fromAUI","1"),r.append("pageAction","delete-active"),r.append("actionType","delete"),fetch("/gp/cart/ajax-update.html/ref=ox_sc_cart_delete_1",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:r}).then(function(e){return e.text().then(function(e){return"ok"})})})})},L=function(e,t,r){a("update_results",{info:e,qty:t,limit:r})};return{init:function(e){a=e.post,(o=e.settings).loadAllOffers&&5,p()},checkASINAndRestart:function(){var e=h();i!==e&&u()},restart:u,onMessage:function(e,t){if("page.next"===e){if(h(),g.next()<0)return;chrome.runtime.sendMessage({cmd:"cpa.sendEvent",data:["page","next"]}),f()}}}}();
var WidgetController=function(){var e,t,i=function(){chrome.runtime.onMessage.addListener(function(e,i,n){var o=e.cmd;e.data,(i.tab||{}).id;"run"===o&&(AMZHelpers.isProductPage()?(Page.checkASINAndRestart(),t.show()):t&&t.toggle())})},n=function(){window.addEventListener("message",function(e){var i=e.data;if("object"==typeof i){var n=i.cmd,o=i.data;n&&0===n.indexOf(Prefix.get(""))&&(n=n.replace(Prefix.get(""),""))&&(n.match(/^widget\./)?t.onMessage(n,o):n.match(/^page\./)?Page.onMessage(n,o):"iframe.close"===n&&$iframeRoot.remove())}},!1)},o=function(i){try{(t=new Widget({prefix:Prefix.get(""),id:Prefix.get("widget"),src:chrome.extension.getURL("html/widget.html"),parent:document.body,draggable:!0,handleHTML:['<div class="'+Prefix.get("widget-dd-text")+'">Count Stock! <small>OS Addon<small><span class="'+Prefix.get("widget-sub")+'">'+chrome.runtime.getManifest().version+"</span></div>",'<div class="'+Prefix.get("widget-header-links")+'">','<div class="'+Prefix.get("widget-header-link")+'" data-view="help">Help</div>','<div class="'+Prefix.get("widget-header-link")+'" data-view="settings">Settings</div>',"</div>",'<div class="'+Prefix.get("widget-close")+'">&times;</div>'].join("\n"),onReady:function(){},onShow:function(){t.post("resize")},onHide:function(){},onClosed:function(){},onPositionChanged:function(t){e.position=t,chrome.runtime.sendMessage({cmd:"settings.set",data:{key:"position",value:e.position}})}})).inject(),e.position&&t.setPosition(e.position),t.show(),t.$root.find(Prefix.cc("widget-close")).click(function(){t.toggle()}),t.$root.find(Prefix.cc("widget-header-link")).click(function(){t.post("set_view",this.dataset.view)})}catch(e){}};return{init:function(){chrome.runtime.sendMessage({cmd:"settings.get",data:{}},function(s){e=s,i(),n(),o(),Page.init({post:t.post.bind(t),settings:e})})}}}();