var Prefix=function(){var n="",r=function(r){return n+"-"+r};return{init:function(r){n=r},_:r,get:r,id:function(n){return"#"+r(n)},cc:function(n){return"."+r(n)},data:function(r){return n+"_"+r.replace(/-/g,"_")}}}();
Prefix.init("scxt");
var Helpers=function(){var e=function(e,r){void 0===r&&(r=2);var n=Number(e),a=!1;n<0&&(a=!0,n=-n);var o=(e=n.toFixed(r)).split(".");o[0]=Number(o[0]).toLocaleString();var i=t(),c=o.join(i);return a&&(c="-"+c),c},t=function(){var e=".";try{var t=parseFloat(1.5).toLocaleString().substring(1,2);"."!==t&&","!==t||(e=t)}catch(e){}return e};return Object.defineProperty(Array.prototype,"chunk",{value:function(e){for(var t=[],r=0;r<this.length;r+=e)t.push(this.slice(r,r+e));return t}}),Object.defineProperty(Array.prototype,"merge",{value:function(){for(var e=0;e<arguments.length;e++)for(var t=arguments[e],r=0;r<t.length;r++)-1===this.indexOf(t[r])&&this.push(t[r]);return this}}),String.prototype.toUpperCaseFirstChar=function(){return this.substr(0,1).toUpperCase()+this.substr(1)},{cleanHTML:function(e,t){return e=(e=(e=e.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"")).replace(/<style[\s\S]*?\/style>/gi,"")).replace(/onload=".*?"/gi,""),t&&t.image||(e=e.replace(/<img[^>]*>/gi,"")),e=e.replace(/<form [\s\S]+?<\/form>/gi,"")},getURLParam:function(e,t){t||(t=document.location);for(var r=t.search.substring(1).split("&"),n=0;n<r.length;n++){var a=r[n].split("=");if(a[0]==e)return a[1]}},removeURLParam:function(e,t){var r=t.split("?")[0],n=[],a=-1!==t.indexOf("?")?t.split("?")[1]:"";if(""!==a){for(var o=(n=a.split("&")).length-1;o>=0;o-=1)n[o].split("=")[0]===e&&n.splice(o,1);r=r+"?"+n.join("&")}return r},getHost:function(e){var t=document.createElement("a");return t.href=e,t.host},getDomainName:function(e){var t=e.split(".").reverse();return t.length>=3&&t[1].match(/^(com|edu|gov|net|mil|org|nom|co|name|info|biz)$/i)?t[2]+"."+t[1]+"."+t[0]:t[1]+"."+t[0]},getDate:function(e,t){void 0===t&&(t=new Date),e||(e="YYYY-MM-DD hh:mm:ss");var r=t.getFullYear(),n="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ")[t.getMonth()],a=("0"+(t.getMonth()+1)).substr(-2),o=("0"+t.getDate()).substr(-2),i=("0"+t.getHours()).substr(-2),c=("0"+t.getMinutes()).substr(-2),u=("0"+t.getSeconds()).substr(-2),s=e;return s=(s=(s=(s=(s=(s=(s=(s=s.replace("YYYY",r)).replace(/YY/g,r.toString().substr(-2))).replace("MMMM",n)).replace("MM",a)).replace("DD",o)).replace("hh",i)).replace("mm",c)).replace("ss",u)},clipboardWrite:function(e){var t=document.createElement("textarea");document.body.appendChild(t),t.value=e,t.select(),document.execCommand("copy"),t.parentNode.removeChild(t)},saveToFile:function(e,t){var r=document.createElement("a");r.download=t,r.href=e,r.click()},arrayToCSV:function(e,t){var r=[];return e.map(function(e){var n='"'+(e=e.map(function(e){return void 0===e&&(e=""),e=(e=(e=e.toString()).replace(/\r?\n|\r/g," ")).replace(/"/g,'""')})).join('"'+t+'"')+'"';r.push(n)}),r.join("\n")},injectInlineJS:function(e,t){t||(t=[]),t=t.map(function(e){return'"'+e+'"'});var r=document.createElement("script");r.textContent="("+e+")("+t.join(",")+")",(document.head||document.documentElement).appendChild(r),r.parentNode.removeChild(r)},formatNumber:e,getDecimalSeparator:t,deepSearchFormatNumber:function(t,r){for(var n=t,a=0,o=(r=r.split(".")).length;a<o;a++){if(void 0===n[r[a]])return;a===o-1?n[r[a]+"_fmt"]=e(n[r[a]],2):n=n[r[a]]}},getNrString:function(e){if("number"!=typeof e)return e;if(0===e)return e+"";var t=parseInt(Math.floor(Math.log(e)/Math.log(1e3)));return Math.round(e/Math.pow(1e3,t),2)+["","K","M","G","T"][t]},percent:function(e){return e?(100*parseFloat(e)).toFixed(0):""},convertPriceToNumber:function(e){var r,n=e.replace(/[^\d,.]+/g,"");return"."===n.substr(-1)&&(n=n.substr(0,n.length-1)),n?("."===(r=(n=n.replace(/[.,]+$/,"")).substr(-3,1).match(/[.,]/)?n.substr(-3,1):n.substr(-2,1).match(/[.,]/)?n.substr(-2,1):t())&&(n=n.replace(/,/g,"")),","===r&&(n=(n=n.replace(/\./g,"")).replace(",",".")),parseFloat(n)):0}}}();
var WidgetHelpers={resize:function(e){e||(e={}),"undefined"==typeof Prefix&&(Prefix={get:function(e){return e}});var t={width:e.width?e.width:document.body.offsetWidth,height:e.height?e.height:document.body.offsetHeight};e.extraHeight&&(t.height+=e.extraHeight+10),e.heightOnly&&delete t.width,window.parent.postMessage({cmd:Prefix.get("widget.resize"),data:t},"*")}};
(function(){(navigator.userAgent.match(/(Chrome|Firefox)/)||[])[1];var e,t,i=!0,n={},a=[],r=[{key:"seller",sort:"string",name:"Seller"},{key:"qty",sort:"custom",name:"Qty"},{key:"pricePlusShip",sort:"custom",name:"Price"},{key:"type",sort:"string",name:"Type"},{key:"rating",sort:"custom",name:"Rating"},{key:"condition",sort:"string",name:"Cond"},{key:"delivery",sort:"int",name:"Deliv"}],o=[{key:"asin",name:"ASIN"},{key:"name",name:"Seller Name"},{key:"sellerId",name:"Seller ID"},{key:"type",name:"Type"},{key:"ratingScore",name:"Rating"},{key:"ratingVal",name:"Rating Count"},{key:"conditionEn",name:"Condition"},{key:"deliveryStr",name:"Delivery"},{key:"price",name:"Price"},{key:"shipPrice",name:"Ship Price"},{key:"pricePlusShip",name:"Price + Ship"},{key:"qty",name:"Qty"},{key:"limitYN",name:"Has Limit"}],s={totalQty:0,offers:0,qtyFBA:0,qtyFBM:0,qtyAMZ:0},l=function(t){chrome.runtime.sendMessage({cmd:"settings.get"},function(i){e=i,t(i)})},c=function(){window.addEventListener("message",function(e){var t=e.data;if("object"==typeof t){var n=t.cmd,a=t.data,r=Prefix.get("");if(0===n.indexOf(r))if("update_results"===(n=n.replace(r,"")))x(a);else if("clear_results"===n)k();else if("error"===n)$(".spinner").addClass("hidden"),$(".status").text("An error has occured ("+a+"). Please try again later.").removeClass("hidden");else if("loading"===n)$(".spinner").removeClass("hidden");else if("loading_done"===n)$(".spinner").addClass("hidden");else if("pageCount.status"===n){var o=a;$(".load-more").toggleClass("hidden",o),i=o}else"status"===n?$(".status").html(a).toggleClass("hidden",a):"resize"===n?S():"set_view"===n&&d(a)}},!1)},d=function(e){$(".view").addClass("hidden"),$(".view-"+e).removeClass("hidden")},f=function(e){var n=$("body");u(),t=$("#results");var o="";r.map(function(e){o+=`<th data-sort="${e.sort}">${e.name}</th>`}),t.find("thead").append("<tr>"+o+"</tr>"),t.find("th[data-sort]").append('<span class="sort-icon"></span>'),t.stupidtable_settings({will_manually_build_table:!0}),t.stupidtable({custom:function(e,t){var i,n;return i=e.replace(/[^\d. ]/g,""),n=t.replace(/[^\d. ]/g,""),i&&n?(i=parseFloat(i)||1/0)-(n=parseFloat(n)||1/0):("-"===e&&(e=""),"-"===t&&(t=""),e>t?1:e==t?0:-1)}}),t.bind("aftertablesort",function(e,t){F()}),t.find("th:nth-child(3)").stupidsort("asc"),$(".filter-item a").click(function(e){e.preventDefault();var t=$(this);t.closest(".filter-item").find("a.active").removeClass("active"),t.addClass("active"),F()}),$("#price-filter-from, #price-filter-to").change(function(e){F()}),$("#price-filter-from, #price-filter-to").keyup(function(e){setTimeout(F,0)}),n.on("click",".btn-load-more",function(e){i=!0,g("page.next"),$(".load-more").addClass("hidden"),$(".spinner").removeClass("hidden")}),$(".view-btn").click(function(e){e.preventDefault(),d(this.dataset.view)}),$(".expand-btn").click(function(e){var t=$(this);t.hasClass("expanded")?(g("widget.collapse"),t.removeClass("expanded")):(g("widget.expand"),t.addClass("expanded"))}),n.on("click",".btn-export",function(e){e.preventDefault();var t=p(a,"headers"),i=["osa_offers",a[0].asin,Helpers.getDate("YYYYMMDD_hhmmss")].join("_")+".csv",n="data:application/csv;charset=utf-8,\ufeff"+encodeURIComponent(t);Helpers.saveToFile(n,i)}),n.on("click",".btn-copy",function(e){e.preventDefault();var t=p(a,"");Helpers.clipboardWrite(t)})},p=function(t,i){if(!t.length)return"";var n=[],a=(e.exportOrder||"").split(/\s*,\s*/);if(i){var r=[];a.map(function(e){var t=v(e);r.push(t)}),n.push(r)}t.map(function(e){var t=[];a.map(function(i){t.push(e[i])}),n.push(t)});var o=i?",":"\t";return Helpers.arrayToCSV(n,o)},u=function(){var t=o.map(function(e){return e.name}).join(", ");$("#export-order-default").text(t),$("#set-export-default-btn").click(function(e){e.preventDefault(),$("#input-exportOrder").val(t).trigger("change")}),$(".view-settings input").map(function(t,i){var n=i.id;if(0===n.indexOf("input-")){var a=n.replace("input-","");if("checkbox"===i.type&&$(i).prop("checked",e[a]),"exportOrder"===a){var r=[];(e.exportOrder||"").split(/\s*,\s*/).map(function(e){var t=v(e);r.push(t)}),i.value=r.join(", ")}}}),$(".view-settings input").change(function(){var t=this.id;if(0===t.indexOf("input-")){var i=t.replace("input-",""),n=this.value;"checkbox"===this.type&&(n=this.checked),"exportOrder"===i&&(n=m(n)),e[i]=n,y(i,n)}})},m=function(e){var t=$.trim(e).split(/\s*,\s*/),i=[];return t.map(function(e){var t=h(e.toLowerCase());t&&i.push(t)}),i.join(",")},h=function(e){for(var t=0,i=o.length;t<i;t++){var n=o[t];if(n.name.toLowerCase()===e)return n.key}return""},v=function(e){for(var t=0,i=o.length;t<i;t++){var n=o[t];if(n.key===e)return n.name}return""},y=function(e,t){chrome.runtime.sendMessage({cmd:"settings.set",data:{key:e,value:t}})},g=function(e,t){window.parent.postMessage({cmd:Prefix.get(e),data:t},"*")},k=function(){for(var e in s)s[e]=0;$(".counts-container").text(""),t.find("tbody").text(""),t.addClass("hidden"),$(".limit-hint").addClass("hidden")},C=function(e,t){t||(t=s);var i=parseInt(e.qty)||0,n=e.type;t.offers++,t.totalQty+=i,"FBA"===n?t.qtyFBA+=i:"AMZ"===n?t.qtyAMZ+=i:"FBM"===n&&(t.qtyFBM+=i),w(t)},x=function(e){e.info.last&&$(".spinner").addClass("hidden");var i=e.info.offer,a={schost:e.info.host.replace(/^(www|smile)\./,"sellercentral."),offerId:e.info.offer.offerId,offerIdEnc:btoa(e.info.offer.offerId),asin:e.info.asin,isAmazon:(i.name||"").match(/amazon/i),name:i.name,sellerId:e.info.offer.sellerId,qty:e.qty,price:i.price,shipPrice:i.shipPrice||0,limit:e.limit,limitYN:!0===e.limit?"Yes":"",type:i.fba?"FBA":"FBM",delivery:i.delivery||0,condition:i.condition.short,conditionEn:i.condition.en};a.deliveryStr=a.delivery?Helpers.getDate("MMMM DD",new Date(i.delivery)):"",999===e.qty&&(a.moreThan999=!0),a.isAmazon?a.type="AMZ":a.url="https://"+e.info.host+"/gp/aag/main/ref=olp_merch_name_1?ie=UTF8&asin="+e.info.asin+"&isAmazonFulfilled=1&seller="+e.info.offer.sellerId,i.rating>=0&&(a.rating=i.rating+"%",a.ratingScore=i.rating+"%"),i.ratingVal>0&&(a.rating+=' <div class="rating-small">'+i.ratingVal.toLocaleString()+"</div>",a.ratingVal=i.ratingVal),a.pricePlusShip=(i.price+i.shipPrice).toFixed(2),C(a),n[a.offerIdEnc]=a;var r=Mustache.to_html($("#tpl-table-row").text(),a);$(r).appendTo(t.find("tbody")).find(".amz-calc-btn").click(function(e){var t=this.dataset.asin,i=parseFloat(this.dataset.price)||0,n=parseFloat(this.dataset.shipPrice)||0;chrome.runtime.sendMessage({cmd:"sc.set_data",data:{asin:t,price:i,shipPrice:n}})}),t.removeClass("hidden").stupidtable_build(),a.limit&&$(".limit-hint").removeClass("hidden"),$(".filters-container").removeClass("hidden"),b(),F(),S()},b=function(){var e=A();e&&$(e.th).stupidsort(e.asc?"asc":"desc")},F=function(){var e={totalQty:0,offers:0,qtyFBA:0,qtyFBM:0,qtyAMZ:0};a=[],w(e),t.find("tbody tr").map(function(t,i){M(i,e)}),S()},M=function(e,t){var i=P(),o={},s=$(e),l=s.find("td"),c=s.data("offerid");r.map(function(e,t){o[e.key]=l[t].textContent,"condition"===e.key&&(o.condition=l[t].dataset.condition)});var d=!1;i.priceFrom>=0&&parseFloat(o.pricePlusShip)<i.priceFrom&&(d=!0),i.priceTo>=0&&parseFloat(o.pricePlusShip)>i.priceTo&&(d=!0),"fba"===i.type&&"FBA"!==o.type&&"AMZ"!==o.type&&(d=!0),"fbm"===i.type&&"FBM"!==o.type&&(d=!0),"all"!==i.condition&&i.condition!==o.condition&&(d=!0),d||(C(o,t),a.push(n[c])),s.toggleClass("filtered",d)},w=function(e){var t=$.extend({},e);for(var n in t)t[n]=e[n].toLocaleString();var a=Mustache.to_html($("#tpl-total-row").text(),t);$(".counts-container").html(a),$(".load-more").toggleClass("hidden",i)},A=function(){var e=t.find("th.sorting-asc, th.sorting-desc")[0];if(e)return{th:e,asc:e.classList.contains("sorting-asc")}},P=function(){var e={};return e.priceFrom=parseFloat($("#price-filter-from").val()),e.priceTo=parseFloat($("#price-filter-to").val()),e.type=$(".filter-type.active").data("val"),e.condition=$(".filter-condition.active").data("val"),e},S=function(){WidgetHelpers.resize({heightOnly:!0}),setTimeout(function(){document.body.offsetHeight>document.documentElement.clientHeight&&$(".expand-btn").fadeIn()},2e3)};return{init:function(){l(function(e){c(),f(e),g("widget.ready")})}}})().init();