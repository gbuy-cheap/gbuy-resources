chrome.runtime.onMessage.addListener((e,t,a)=>{const{query:n,params:l}=e;if("checkSellPermision"===n)return checkCanSellOfProducts(l).then(a),!0});const checkCanSellOfProducts=async({asin:e,domain:t})=>{axios.default.withCredentials=!0;const a=window.listMarketplaces[t],n=await handleCanISellNewUI(a,e),{isCanISell:l,info:i,infoSelling:s,infoSellingData:r,isTransparency:o}=n;return{asin:e,isCanSell:l,info:i,infoSelling:s?s.replaceAll("chrome-extension://"+a.domainSeller,"https://"+a.domainSeller):null,infoSellingData:r||null,isTransparency:o}},createElement=({tag:e,classList:t=null,style:a=null,id:n=null})=>{const l=document.createElement(e);return t&&t.map(e=>l.classList.add(e)),a&&(l.style={...l.style,...a}),n&&(l.id=n),l},handleCanISellNewUI=async(e,t)=>{let a,n,l=null,i=null,s=!1,r=!1;try{const o=await axios.get(`https://${e.domainSeller}/hz/approvalrequest/restrictions/approve?asin=${t}&language=${e.lang}`);if(o&&200===o.status){const c=(new DOMParser).parseFromString(o.data,"text/html");if(l=!!c.querySelector('a[data-csm="saw-landing-page-sell-yours-button-click"]'),!0===l&&(s=c.querySelector(".a-unordered-list.a-vertical.saw-ack-list")||null,s=!!(s&&s.innerText&&s.innerText.includes("New")),!1===s&&(l=!1)),!1===l){const l=await axios.get(`https://${e.domainSeller}/productsearch/v2/search?q=${t}&page=1`);if(l&&200===l.status){const{products:t}=l.data||{products:[{}]},{qualificationMessages:s=[]}=t[0];if(s&&s.length>0){const e=createElement({tag:"div",classList:["a-spacing-top-mini","a-fixed-right-grid-col","a-col-left"],style:{"padding-right":"0%",float:"left"}}),t=createElement({tag:"ul",classList:["a-unordered-list","a-vertical","a-spacing-top-mini"]});s.map(({conditionList:e,qualificationMessage:a})=>{const n=createElement({tag:"span",classList:["a-text-bold"]});n.textContent=e?e+" ":"";const l=createElement({tag:"span"});l.textContent=a;const i=createElement({tag:"span",classList:["a-list-item"]});i.append(n,l);const s=createElement({tag:"li",classList:["a-align-center"]});s.appendChild(i),t.append(s)});const a=document.createElement("p");a.style.color="red",a.innerText="You are NOT eligible to list this product on Amazon",e.appendChild(a),t&&(e.appendChild(t),Array.from(e.querySelectorAll("a")).map(e=>{e.target="_blank"})),i=outerHTML(e,!0)||null}if(a=getInfoWhenCanNotSell(e,c),a){const t=c.querySelector("[name=appFormPageCsrfToken]");n={url:`https://${e.domainSeller}/hz/approvalrequest?asin=B084D3GLCY&itemcondition=null`,data:{appFormPageCsrfToken:t?t.value:null}}}}}const p=await axios.post("https://sellercentral.amazon.com/hz/myqdashboard/refresh-table?ref_=xx_xx_cont_xx",{action:"CUSTOM_REFRESH",pageNumber:1,recordsPerPage:null,sortedColumnId:"changedDate",sortOrder:"DESCENDING",tableId:"app_dashboard",filters:[],clientState:{filter:"Search",expander:"collapsed",inputString:t}},{headers:{"content-type":"application/json","x-requested-with":"XMLHttpRequest",priority:"u=1, i"}});if(p&&200===p.status){const e=p.data&&-1!==p.data.indexOf("approvalrequest?applicationId=")&&p.data.split("approvalrequest?applicationId=").pop().split('"')[0];if(e){const t=await axios.get(`https://sellercentral.amazon.com/hz/approvalrequest/approve?input-value=${e}&input-type=applicationId&application-id=${e}`);t&&200===t.status&&(r=t.data&&-1!==t.data.indexOf("Transparency Listing Application"))}}}}catch(e){console.log(e),l=null}return{isCanISell:l,info:i,infoSelling:a,infoSellingData:n,isTransparency:r}},getInfoWhenCanNotSell=(e,t)=>{const a=t.querySelector(".a-section.a-spacing-none.saw-module-container")||null;return a&&Array.from(a.querySelectorAll("a")).map(t=>{t&&(t.href=""+t.href.replace(window.location.host,e.domainSeller),t.target="_blank")}),a?outerHTML(a,!0):null};